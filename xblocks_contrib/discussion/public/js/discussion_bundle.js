/*! For license information please see discussion_bundle.js.LICENSE.txt */
(()=>{var __webpack_modules__={290(e,t){(function(){var e;e=t,function(){function t(e){return e}function n(e){return!1}function i(){}function o(){}i.prototype={chain:function(e,n){var i=this[e];if(!i)throw new Error("unknown hook "+e);this[e]=i===t?n:function(e){return n(i(e))}},set:function(e,t){if(!this[e])throw new Error("unknown hook "+e);this[e]=t},addNoop:function(e){this[e]=t},addFalse:function(e){this[e]=n}},e.HookCollection=i,o.prototype={set:function(e,t){this["s_"+e]=t},get:function(e){return this["s_"+e]}},e.Converter=function(){var e,t,n,r,s=this.hooks=new i;function a(e){return(e=(e=(e=(e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,d)).replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,d)).replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,d)).replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,d)).replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,d)}function d(e,t){var i=t;return i=(i=i.replace(/^\n+/,"")).replace(/\n+$/g,""),"\n\n~K"+(n.push(i)-1)+"K\n\n"}function l(e,t){var i="<hr />\n";return e=function(e,t){for(var i=(e=(e=e.replace(/^\n+/g,"")).replace(/\n+$/g,"")).split(/\n{2,}/g),o=[],r=/~K(\d+)K/,s=i.length,a=0;a<s;a++){var d=i[a];r.test(d)?o.push(d):/\S/.test(d)&&(d=(d=c(d)).replace(/^([ \t]*)/g,"<p>"),d+="</p>",o.push(d))}if(!t)for(s=o.length,a=0;a<s;a++)for(var l=!0;l;)l=!1,o[a]=o[a].replace(/~K(\d+)K/g,function(e,t){return l=!0,n[t]});return o.join("\n\n")}(e=a(e=function(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var i=t;return i=(i=(i=l(i=(i=(i=i.replace(/^[ \t]*>[ \t]?/gm,"~0")).replace(/~0/g,"")).replace(/^[ \t]+$/gm,""))).replace(/(^|\n)/g,"$1  ")).replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return(n=n.replace(/^ {2}/gm,"~0")).replace(/~0/g,"")}),function(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(n.push(e)-1)+"K\n\n"}("<blockquote>\n"+i+"\n</blockquote>")})}(e=function(e){return e=(e=(e+="~0").replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,n){var i=n;return"\n\n"+("<pre><code>"+v(y(w(t))).replace(/^\n+/g,"").replace(/\n+$/g,"")+"\n</code></pre>")+"\n\n"+i})).replace(/~0/,"")}(e=m(e=(e=(e=(e=function(e){return e=(e=(e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return"<h1>"+c(t)+"</h1>\n\n"})).replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return"<h2>"+c(t)+"</h2>\n\n"})).replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,n){var i=t.length;return"<h"+i+">"+c(n)+"</h"+i+">\n\n"})}(e)).replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,i)).replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,i)).replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,i))))),t),e}function c(e){return(e=function(e){return e=(e=e.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4")).replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4")}(e=_(e=(e=function(e){return e=(e=e.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4")).replace(/<((https?|ftp):[^'">\s]+)>/gi,function(e,t){return'<a href="'+t+'">'+s.plainLinkText(t)+"</a>"})}(e=function(e){return e=(e=(e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,u)).replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,u)).replace(/(\[([^\[\]]+)\])()()()()()/g,u)}(e=function(e){return e=(e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,h)).replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,h)}(e=function(e){return e=(e=e.replace(/\\(\\)/g,$)).replace(/\\([`*_{}\[\]()>#+-.!])/g,$)}(e=function(e){return e=e.replace(/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return b(t,"!"==e.charAt(1)?"\\`*_/":"\\`*_")})}(e=function(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,i,o){return t+"<code>"+y(i.replace(/^([ \t]*)/g,"").replace(/[ \t]*$/g,"")).replace(/:\/\//g,"~P")+"</code>"})}(e))))))).replace(/~P/g,"://")))).replace(/  +\n/g," <br>\n")}function u(n,i,o,r,s,a,d,l){null==l&&(l="");var c=i,u=o.replace(/:\/\//g,"~P"),h=r.toLowerCase(),m=s,f=l;if(""==m)if(""==h&&(h=u.toLowerCase().replace(/ ?\n/g," ")),m="#"+h,null!=e.get(h))m=e.get(h),null!=t.get(h)&&(f=t.get(h));else{if(!(c.search(/\(\s*\)$/m)>-1))return c;m=""}var g='<a href="'+(m=function(e){return e=b(e=p(e),"*_:()[]")}(m))+'"';return""!=f&&(g+=' title="'+(f=b(f=p(f),"*_"))+'"'),g+">"+u+"</a>"}function p(e){return e.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function h(n,i,o,r,s,a,d,l){var c=i,u=o,h=r.toLowerCase(),m=s,f=l;if(f||(f=""),""==m){if(""==h&&(h=u.toLowerCase().replace(/ ?\n/g," ")),m="#"+h,null==e.get(h))return c;m=e.get(h),null!=t.get(h)&&(f=t.get(h))}u=b(p(u),"*_[]()");var g='<img src="'+(m=b(m,"*_"))+'" alt="'+u+'"';return(g+=' title="'+(f=b(f=p(f),"*_"))+'"')+" />"}function m(e){e+="~0";var t=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return r?e=e.replace(t,function(e,t,n){var i=t,o=n.search(/[*+-]/g)>-1?"ul":"ol",r=g(i,o);return"<"+o+">"+(r=r.replace(/\s+$/,""))+"</"+o+">\n"}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(t,function(e,t,n,i){var o=t,r=n,s=i.search(/[*+-]/g)>-1?"ul":"ol",a=g(r,s);return o+"<"+s+">\n"+a+"</"+s+">\n"})),e.replace(/~0/,"")}s.addNoop("plainLinkText"),s.addNoop("preConversion"),s.addNoop("postConversion"),this.makeHtml=function(i){if(e)throw new Error("Recursive call to converter.makeHtml");return e=new o,t=new o,n=[],r=0,i=(i=(i=function(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)})}(i=l(i=function(n){return n=n.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(n,i,o,r,s,a){return i=i.toLowerCase(),e.set(i,_(o)),s?r:(a&&t.set(i,a.replace(/"/g,"&quot;")),"")})}(i=a(i=(i=v(i="\n\n"+(i=(i=(i=(i=(i=s.preConversion(i)).replace(/~/g,"~T")).replace(/\$/g,"~D")).replace(/\r\n/g,"\n")).replace(/\r/g,"\n"))+"\n\n")).replace(/^[ \t]+$/gm,"")))))).replace(/~D/g,"$$")).replace(/~T/g,"~"),i=s.postConversion(i),n=t=e=null,i};var f={ol:"\\d+[.]",ul:"[*+-]"};function g(e,t){r++,e=e.replace(/\n{2,}$/,"\n"),e+="~0";var n=f[t],i=new RegExp("(^[ \\t]*)("+n+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+n+")[ \\t]+))","gm"),o=!1;return e=(e=e.replace(i,function(e,t,n,i){var r=i,s=/\n\n$/.test(r),a=s||r.search(/\n{2,}/)>-1;return r=a||o?l(w(r),!0):c(r=(r=m(w(r))).replace(/\n$/,"")),o=s,"<li>"+r+"</li>\n"})).replace(/~0/g,""),r--,e}function y(e){return b(e=(e=(e=e.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),"*_{}[]\\",!1)}function _(e){return(e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;")).replace(/<(?![a-z\/?\$!])/gi,"&lt;")}function w(e){return(e=e.replace(/^(\t|[ ]{1,4})/gm,"~0")).replace(/~0/g,"")}function v(e){if(!/\t/.test(e))return e;var t,n=["    ","   ","  "," "],i=0;return e.replace(/[\n\t]/g,function(e,o){return"\n"===e?(i=o+1,e):(t=(o-i)%4,i=o+1,n[t])})}function b(e,t,n){var i="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(i="\\\\"+i);var o=new RegExp(i,"g");return e.replace(o,$)}function $(e,t){return"~E"+t.charCodeAt(0)+"E"}}}()}).call(window),window.Markdown=t},786(e,t,n){(function(){!function(){var e,i;function o(e){return e.replace(/<[^>]*>?/gi,d)}e=t,i=n(290).Converter,e.getSanitizingConverter=function(){var e=new i;return e.hooks.chain("postConversion",o),e.hooks.chain("postConversion",l),e};var r=/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,s=/^(<a\shref="((https?|ftp):\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,a=/^(<img\ssrc="(https?:\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i;function d(e){return e.match(r)||e.match(s)||e.match(a)?e:""}function l(e){if(""==e)return"";var t,n,i=/<\/?\w+[^>]*(\s|$|>)/g,o=e.toLowerCase().match(i),r=(o||[]).length;if(0==r)return e;for(var s,a=[],d=[],l=!1,c=0;c<r;c++)if(t=o[c].replace(/<\/?(\w+).*/,"$1"),!(a[c]||"<p><img><br><li><hr>".search("<"+t+">")>-1)){if(n=o[c],s=-1,!/^<\//.test(n))for(var u=c+1;u<r;u++)if(!a[u]&&o[u]==="</"+t+">"){s=u;break}-1==s?l=d[c]=!0:a[s]=!0}return l?(c=0,e=e.replace(i,function(e){var t=d[c]?"":e;return c++,t}),e):e}}()}).call(window),window.Markdown.getSanitizingConverter=t.getSanitizingConverter},398(){(function(){var e;e=e||function(e){var t,n=String.prototype.split,i=/()??/.exec("")[1]===e;return t=function(t,o,r){if("[object RegExp]"!==Object.prototype.toString.call(o))return n.call(t,o,r);var s,a,d,l,c=[],u=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.extended?"x":"")+(o.sticky?"y":""),p=0;for(o=new RegExp(o.source,u+"g"),t+="",i||(s=new RegExp("^"+o.source+"$(?!\\s)",u)),r=r===e?-1>>>0:r>>>0;(a=o.exec(t))&&!((d=a.index+a[0].length)>p&&(c.push(t.slice(p,a.index)),!i&&a.length>1&&a[0].replace(s,function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(a[t]=e)}),a.length>1&&a.index<t.length&&Array.prototype.push.apply(c,a.slice(1)),l=a[0].length,p=d,c.length>=r));)o.lastIndex===a.index&&o.lastIndex++;return p===t.length?!l&&o.test("")||c.push(""):c.push(t.slice(p)),c.length>r?c.slice(0,r):c},String.prototype.split=function(e,n){return t(this,e,n)},t}(),window._split=e}).call(window)},514(){(function(){(function(){"use strict";var e={}.hasOwnProperty;function t(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t}var n=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};"undefined"!=typeof Backbone&&null!==Backbone&&(this.Content=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return t(e,Backbone.Model),e.contents={},e.contentInfos={},e.prototype.template=function(){return DiscussionUtil.getTemplate("_content")},e.prototype.actions={editable:".admin-edit",can_reply:".discussion-reply",can_delete:".admin-delete",can_openclose:".admin-openclose",can_report:".admin-report",can_vote:".admin-vote"},e.prototype.urlMappers={},e.prototype.urlFor=function(e){return this.urlMappers[e].apply(this)},e.prototype.can=function(e){return(this.get("ability")||{})[e]},e.prototype.canBeEndorsed=function(){return!1},e.prototype.updateInfo=function(e){if(e)return this.set("ability",e.ability),this.set("voted",e.voted),this.set("subscribed",e.subscribed)},e.prototype.addComment=function(e,t){var n,i,o;return(t=t||{}).silent||(o=this.get("thread"),n=parseInt(o.get("comments_count")),o.set("comments_count",n+1)),this.get("children").push(e),i=new Comment($.extend({},e,{thread:this.get("thread")})),this.get("comments").add(i),this.trigger("comment:add"),i},e.prototype.removeComment=function(e){var t,n;return n=this.get("thread"),t=parseInt(n.get("comments_count")),n.set("comments_count",t-1-e.getCommentsCount()),this.trigger("comment:remove")},e.prototype.resetComments=function(e){var t,n,i,o,r;for(this.set("children",[]),this.set("comments",new Comments),r=[],n=0,i=(o=e||[]).length;n<i;n++)t=o[n],r.push(this.addComment(t,{silent:!0}));return r},e.prototype.initialize=function(){var t;return e.addContent(this.id,this),(t=this.get("user_id"))?(this.set("staff_authored",DiscussionUtil.isStaff(t)),this.set("community_ta_authored",DiscussionUtil.isTA(t)||DiscussionUtil.isGroupTA(t))):(this.set("staff_authored",!1),this.set("community_ta_authored",!1)),e.getInfo(this.id)&&this.updateInfo(e.getInfo(this.id)),this.set("user_url",DiscussionUtil.urlFor("user_profile",t)),this.resetComments(this.get("children"))},e.prototype.remove=function(){return"comment"===this.get("type")?(this.get("thread").removeComment(this),this.get("thread").trigger("comment:remove",this)):this.trigger("thread:remove",this)},e.addContent=function(e,t){this.contents[e]=t},e.getContent=function(e){return this.contents[e]},e.getInfo=function(e){return this.contentInfos[e]},e.loadContentInfos=function(e){var t,n;for(t in e)e.hasOwnProperty(t)&&(n=e[t],this.getContent(t)&&this.getContent(t).updateInfo(n));return $.extend(this.contentInfos,e)},e.prototype.pinThread=function(){var e;return e=this.get("pinned"),this.set("pinned",e),this.trigger("change",this)},e.prototype.unPinThread=function(){var e;return e=this.get("pinned"),this.set("pinned",e),this.trigger("change",this)},e.prototype.flagAbuse=function(){var e;return(e=this.get("abuse_flaggers")).push(window.user.get("id")),this.set("abuse_flaggers",e),this.trigger("change",this)},e.prototype.unflagAbuse=function(){return this.get("abuse_flaggers").pop(window.user.get("id")),this.trigger("change",this)},e.prototype.isFlagged=function(){var e,t;return t=DiscussionUtil.getUser(),e=this.get("abuse_flaggers"),t&&(n.call(e,t.id)>=0||DiscussionUtil.isPrivilegedUser(t.id)&&e.length>0)},e.prototype.incrementVote=function(e){var t;return(t=_.clone(this.get("votes"))).up_count+=e,this.set("votes",t)},e.prototype.vote=function(){return this.incrementVote(1)},e.prototype.unvote=function(){return this.incrementVote(-1)},e}(),this.Thread=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.urlMappers={retrieve:function(){return DiscussionUtil.urlFor("retrieve_single_thread",this.get("commentable_id"),this.id)},reply:function(){return DiscussionUtil.urlFor("create_comment",this.id)},unvote:function(){return DiscussionUtil.urlFor("undo_vote_for_"+this.get("type"),this.id)},upvote:function(){return DiscussionUtil.urlFor("upvote_"+this.get("type"),this.id)},downvote:function(){return DiscussionUtil.urlFor("downvote_"+this.get("type"),this.id)},close:function(){return DiscussionUtil.urlFor("openclose_thread",this.id)},update:function(){return DiscussionUtil.urlFor("update_thread",this.id)},_delete:function(){return DiscussionUtil.urlFor("delete_thread",this.id)},follow:function(){return DiscussionUtil.urlFor("follow_thread",this.id)},unfollow:function(){return DiscussionUtil.urlFor("unfollow_thread",this.id)},flagAbuse:function(){return DiscussionUtil.urlFor("flagAbuse_"+this.get("type"),this.id)},unFlagAbuse:function(){return DiscussionUtil.urlFor("unFlagAbuse_"+this.get("type"),this.id)},pinThread:function(){return DiscussionUtil.urlFor("pin_thread",this.id)},unPinThread:function(){return DiscussionUtil.urlFor("un_pin_thread",this.id)}},n.prototype.initialize=function(){return this.set("thread",this),n.__super__.initialize.call(this)},n.prototype.comment=function(){return this.set("comments_count",parseInt(this.get("comments_count"))+1)},n.prototype.follow=function(){return this.set("subscribed",!0)},n.prototype.unfollow=function(){return this.set("subscribed",!1)},n.prototype.display_body=function(){return this.has("highlighted_body")?String(this.get("highlighted_body")).replace(/<highlight>/g,"<mark>").replace(/<\/highlight>/g,"</mark>"):this.get("body")},n.prototype.display_title=function(){return this.has("highlighted_title")?String(this.get("highlighted_title")).replace(/<highlight>/g,"<mark>").replace(/<\/highlight>/g,"</mark>"):this.get("title")},n.prototype.toJSON=function(){var e;return e=_.clone(this.attributes),_.extend(e,{title:this.display_title(),body:this.display_body()})},n.prototype.created_at_date=function(){return new Date(this.get("created_at"))},n.prototype.created_at_time=function(){return new Date(this.get("created_at")).getTime()},n.prototype.hasResponses=function(){return this.get("comments_count")>0},n}(this.Content),this.Comment=function(e){function n(){var e=this;return this.canBeEndorsed=function(){return n.prototype.canBeEndorsed.apply(e,arguments)},n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.urlMappers={reply:function(){return DiscussionUtil.urlFor("create_sub_comment",this.id)},unvote:function(){return DiscussionUtil.urlFor("undo_vote_for_"+this.get("type"),this.id)},upvote:function(){return DiscussionUtil.urlFor("upvote_"+this.get("type"),this.id)},downvote:function(){return DiscussionUtil.urlFor("downvote_"+this.get("type"),this.id)},endorse:function(){return DiscussionUtil.urlFor("endorse_comment",this.id)},update:function(){return DiscussionUtil.urlFor("update_comment",this.id)},_delete:function(){return DiscussionUtil.urlFor("delete_comment",this.id)},flagAbuse:function(){return DiscussionUtil.urlFor("flagAbuse_"+this.get("type"),this.id)},unFlagAbuse:function(){return DiscussionUtil.urlFor("unFlagAbuse_"+this.get("type"),this.id)}},n.prototype.getCommentsCount=function(){var e;return e=0,this.get("comments").each(function(t){return e+=t.getCommentsCount()+1}),e},n.prototype.canBeEndorsed=function(){var e;return(e=window.user.get("id"))&&(DiscussionUtil.isPrivilegedUser(e)||"question"===this.get("thread").get("thread_type")&&this.get("thread").get("user_id")===e)},n}(this.Content),this.Comments=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return t(e,Backbone.Collection),e.prototype.model=Comment,e.prototype.initialize=function(){var e=this;return this.bind("add",function(t){t.collection=e})},e.prototype.find=function(e){return _.first(this.where({id:e}))},e}())}).call(window)}).call(window)},779(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.Discussion=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,Backbone.Collection),t.prototype.model=Thread,t.prototype.initialize=function(e,t){var n=this;return t||(t={}),this.pages=t.pages||1,this.current_page=1,this.sort_preference=t.sort,this.is_commentable_divided=t.is_commentable_divided,this.bind("add",function(e){e.discussion=n}),this.setSortComparator(this.sort_preference),this.on("thread:remove",function(e){n.remove(e)})},t.prototype.find=function(e){return _.first(this.where({id:e}))},t.prototype.hasMorePages=function(){return this.current_page<this.pages},t.prototype.setSortComparator=function(e){switch(e){case"activity":this.comparator=this.sortByDateRecentFirst;break;case"votes":this.comparator=this.sortByVotes;break;case"comments":this.comparator=this.sortByComments}},t.prototype.addThread=function(e){var t;if(!this.find(e.id))return t=new Thread(e),this.add(t),t},t.prototype.retrieveAnotherPage=function(e,t,n,i){var o,r,s=this;switch(t||(t={}),n||(n={}),o={page:this.current_page+1},_.contains(["unread","unanswered","flagged"],t.filter)&&(o[t.filter]=!0),e){case"search":r=DiscussionUtil.urlFor("search"),o.text=t.search_text;break;case"commentables":r=DiscussionUtil.urlFor("retrieve_discussion",t.commentable_ids),o.commentable_ids=t.commentable_ids;break;case"all":r=DiscussionUtil.urlFor("threads");break;case"followed":r=DiscussionUtil.urlFor("followed_threads",t.user_id);break;case"user":r=DiscussionUtil.urlFor("user_profile",t.user_id)}return t.group_id&&(o.group_id=t.group_id),o.sort_key=n.sort_key||"activity",o.sort_order=n.sort_order||"desc",DiscussionUtil.safeAjax({$elem:this.$el,url:r,data:o,dataType:"json",success:function(e){var t,n,i;return t=s.models,i=function(){var t,n,i,r;for(r=[],t=0,n=(i=e.discussion_data).length;t<n;t++)o=i[t],r.push(new Thread(o));return r}(),n=_.union(t,i),Content.loadContentInfos(e.annotated_content_info),s.pages=e.num_pages,s.current_page=e.page,s.is_commentable_divided=e.is_commentable_divided,s.reset(n)},error:i})},t.prototype.sortByDate=function(e){return this.pinnedThreadsSortComparatorWithDate(e,!0)},t.prototype.sortByDateRecentFirst=function(e){return this.pinnedThreadsSortComparatorWithDate(e,!1)},t.prototype.sortByVotes=function(e,t){var n,i;return n=parseInt(e.get("votes").up_count),i=parseInt(t.get("votes").up_count),this.pinnedThreadsSortComparatorWithCount(e,t,n,i)},t.prototype.sortByComments=function(e,t){var n,i;return n=parseInt(e.get("comments_count")),i=parseInt(t.get("comments_count")),this.pinnedThreadsSortComparatorWithCount(e,t,n,i)},t.prototype.pinnedThreadsSortComparatorWithCount=function(e,t,n,i){return e.get("pinned")&&!t.get("pinned")?-1:t.get("pinned")&&!e.get("pinned")?1:n>i?-1:i>n?1:e.created_at_time()>t.created_at_time()?-1:1},t.prototype.pinnedThreadsSortComparatorWithDate=function(e,t){var n,i,o;return i=new Date(e.get("last_activity_at")).getTime(),e.get("pinned")?(o=new Date,n=new Date(o.getTime()+864e5+i)):n=i,t?n:-n},t}())}).call(window)}).call(window)},189(){(function(){var e;"undefined"==typeof MathJax&&(window.MathJax={menuSettings:{CHTMLpreview:!1}},(e=document.createElement("script")).onload=function(){"use strict";var e,t=window.MathJax;t.Hub.Config({tex2jax:{inlineMath:[["\\(","\\)"],["[mathjaxinline]","[/mathjaxinline]"]],displayMath:[["\\[","\\]"],["[mathjax]","[/mathjax]"]]}}),t.Hub.processSectionDelay=0,t.Hub.signal.Interest(function(t){"End Math"===t[0]&&e()}),e=function(){$(".MathJax_Display").each(function(){this.setAttribute("tabindex","0"),this.setAttribute("aria-live","off"),this.removeAttribute("role"),this.removeAttribute("aria-readonly")})}},window.MathJax={menuSettings:{collapsible:!0,autocollapse:!1,explorer:!0}},e.src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML",document.body.appendChild(e))}).call(window)},376(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.DiscussionCourseSettings=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,Backbone.Model),t}())}).call(this)}).call(window)},840(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.DiscussionUser=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,Backbone.Model),t.prototype.following=function(e){return _.include(this.get("subscribed_thread_ids"),e.id)},t.prototype.voted=function(e){return _.include(this.get("upvoted_ids"),e.id)},t.prototype.vote=function(e){return this.get("upvoted_ids").push(e.id),e.vote()},t.prototype.unvote=function(e){return this.set("upvoted_ids",_.without(this.get("upvoted_ids"),e.id)),e.unvote()},t}())}).call(this)}).call(window)},970(){(function(){(function(){"use strict";this.DiscussionUtil=function(){function e(){}e.wmdEditors={},e.leftKey=37,e.rightKey=39,e.getTemplate=function(e){return $("script#"+e).html()},e.setUser=function(e){this.user=e},e.getUser=function(){return this.user},e.loadRoles=function(e){this.roleIds=e},e.isStaff=function(e){var t;return _.isUndefined(e)&&(e=this.user?this.user.id:void 0),_.isUndefined(this.roleIds)&&(this.roleIds={}),t=_.union(this.roleIds.Moderator,this.roleIds.Administrator),_.include(t,parseInt(e))},e.isTA=function(e){var t;return _.isUndefined(e)&&(e=this.user?this.user.id:void 0),t=_.union(this.roleIds["Community TA"]),_.include(t,parseInt(e))},e.isGroupTA=function(e){var t,n=e;return _.isUndefined(e)&&(n=this.user?this.user.id:void 0),t=_.union(this.roleIds["Group Moderator"]),_.include(t,parseInt(n,10))},e.isPrivilegedUser=function(e){return this.isStaff(e)||this.isTA(e)},e.bulkUpdateContentInfo=function(e){var t,n,i;for(t in i=[],e)e.hasOwnProperty(t)&&(n=e[t],i.push(Content.getContent(t).updateInfo(n)));return i},e.generateDiscussionLink=function(e,t,n){return $("<a>").addClass("discussion-link").attr("href","#").addClass(e).text(t).click(function(){return n(this)})},e.urlFor=function(e,t,n,i){return{follow_discussion:"/courses/"+$$course_id+"/discussion/"+t+"/follow",unfollow_discussion:"/courses/"+$$course_id+"/discussion/"+t+"/unfollow",create_thread:"/courses/"+$$course_id+"/discussion/"+t+"/threads/create",update_thread:"/courses/"+$$course_id+"/discussion/threads/"+t+"/update",create_comment:"/courses/"+$$course_id+"/discussion/threads/"+t+"/reply",delete_thread:"/courses/"+$$course_id+"/discussion/threads/"+t+"/delete",flagAbuse_thread:"/courses/"+$$course_id+"/discussion/threads/"+t+"/flagAbuse",unFlagAbuse_thread:"/courses/"+$$course_id+"/discussion/threads/"+t+"/unFlagAbuse",flagAbuse_comment:"/courses/"+$$course_id+"/discussion/comments/"+t+"/flagAbuse",unFlagAbuse_comment:"/courses/"+$$course_id+"/discussion/comments/"+t+"/unFlagAbuse",upvote_thread:"/courses/"+$$course_id+"/discussion/threads/"+t+"/upvote",downvote_thread:"/courses/"+$$course_id+"/discussion/threads/"+t+"/downvote",pin_thread:"/courses/"+$$course_id+"/discussion/threads/"+t+"/pin",un_pin_thread:"/courses/"+$$course_id+"/discussion/threads/"+t+"/unpin",undo_vote_for_thread:"/courses/"+$$course_id+"/discussion/threads/"+t+"/unvote",follow_thread:"/courses/"+$$course_id+"/discussion/threads/"+t+"/follow",unfollow_thread:"/courses/"+$$course_id+"/discussion/threads/"+t+"/unfollow",update_comment:"/courses/"+$$course_id+"/discussion/comments/"+t+"/update",endorse_comment:"/courses/"+$$course_id+"/discussion/comments/"+t+"/endorse",create_sub_comment:"/courses/"+$$course_id+"/discussion/comments/"+t+"/reply",delete_comment:"/courses/"+$$course_id+"/discussion/comments/"+t+"/delete",upvote_comment:"/courses/"+$$course_id+"/discussion/comments/"+t+"/upvote",downvote_comment:"/courses/"+$$course_id+"/discussion/comments/"+t+"/downvote",undo_vote_for_comment:"/courses/"+$$course_id+"/discussion/comments/"+t+"/unvote",upload:"/courses/"+$$course_id+"/discussion/upload",users:"/courses/"+$$course_id+"/discussion/users",search:"/courses/"+$$course_id+"/discussion/forum/search",retrieve_discussion:"/courses/"+$$course_id+"/discussion/forum/"+t+"/inline",retrieve_single_thread:"/courses/"+$$course_id+"/discussion/forum/"+t+"/threads/"+n,openclose_thread:"/courses/"+$$course_id+"/discussion/threads/"+t+"/close",user_profile:"/courses/"+$$course_id+"/discussion/forum/users/"+t,followed_threads:"/courses/"+$$course_id+"/discussion/forum/users/"+t+"/followed",threads:"/courses/"+$$course_id+"/discussion/forum",enable_notifications:"/notification_prefs/enable/",disable_notifications:"/notification_prefs/disable/",notifications_status:"/notification_prefs/status/"}[e]},e.ignoreEnterKey=function(e){if(13===e.which)return e.preventDefault()},e.activateOnSpace=function(e,t){if(32===e.which)return e.preventDefault(),t(e)},e.makeFocusTrap=function(e){return e.keydown(function(e){if(9===e.which)return e.preventDefault()})},e.showLoadingIndicator=function(e,t){var n=edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML("<div class='loading-animation' tabindex='0'>"),edx.HtmlUtils.HTML("<span class='icon fa fa-spinner' aria-hidden='true'></span><span class='sr'>"),gettext("Loading content"),edx.HtmlUtils.HTML("</span></div>")),i=$(n.toString());e.after(i),this.$_loading=i,t&&(this.makeFocusTrap(this.$_loading),this.$_loading.focus())},e.hideLoadingIndicator=function(){return this.$_loading.remove()},e.discussionAlert=function(e,t){var n,i,o=$("#alert-popup").html()||"";0===$("#discussion-alert").length&&(n=$(edx.HtmlUtils.template(o)({}).toString()),this.makeFocusTrap(n.find("button")),(i=$("<a href='#discussion-alert' id='discussion-alert-trigger'/>").css("display","none")).leanModal({closeButton:"#discussion-alert .dismiss",overlay:1,top:200}),$("body").append(n).append(i)),$("#discussion-alert header h2").text(e),$("#discussion-alert p").text(t),$("#discussion-alert-trigger").click(),$("#discussion-alert button").focus()},e.safeAjax=function(e){var t,n,i=this;return(t=e.$elem)&&t.prop("disabled")?((n=$.Deferred()).reject(),n.promise()):(e.url=URI(e.url).addSearch({ajax:1}),e.error||(e.error=function(){i.discussionAlert(gettext("Error"),gettext("Your request could not be processed. Refresh the page and try again."))}),t&&t.prop("disabled",!0),e.$loading&&(e.loadingCallback?e.loadingCallback.apply(e.$loading):i.showLoadingIndicator(e.$loading,e.takeFocus)),$.ajax(e).always(function(){if(t&&t.prop("disabled",!1),e.$loading)return e.loadedCallback?e.loadedCallback.apply(e.$loading):i.hideLoadingIndicator()}))},e.updateWithUndo=function(e,t,n,i,o){var r,s=this;return i&&(n.error=function(){return s.discussionAlert(gettext("Error"),i)}),r=_.pick(e.attributes,_.keys(t)),e.set(t),"function"==typeof o&&o(),this.safeAjax(n).fail(function(){return e.set(r)})},e.bindLocalEvents=function(e,t){var n,i,o,r,s,a;for(i in a=[],t)t.hasOwnProperty(i)&&(o=t[i],n=(s=i.split(" "))[0],r=s[1],a.push(e(r).unbind(n)[n](o)));return a},e.formErrorHandler=function(e){return function(t){var n,i,o,r;if(n=function(e,t){return edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML("<li>"),edx.HtmlUtils.template($("#new-post-alert-template").html())({message:e,alertId:t}),edx.HtmlUtils.HTML("</li>"))},e.empty().show(),400===t.status){if((i=JSON.parse(t.responseText)).errors)for(o=0;o<i.errors.length;o++)r=n(i.errors[o],o),edx.HtmlUtils.append(e,r)}else r=n("Your request could not be processed. Refresh the page and try again.",0),edx.HtmlUtils.append(e,r);$('div[role="alert"]',e).first().focus()}},e.clearFormErrors=function(e){return e.empty()},e.postMathJaxProcessor=function(e){var t,n;return n=/^\$([^\$]*)\$/g,t=/^\$\$([^\$]*)\$\$/g,this.processEachMathAndCode(e,function(e,i){return"display"===i?e.replace(t,function(e,t){return"\\["+t+"\\]"}):"inline"===i?e.replace(n,function(e,t){return"\\("+t+"\\)"}):e})},e.makeWmdEditor=function(e,t,n){var i,o,r,s,a,d,l;return d=(r=t("."+n)).data("placeholder"),i="-"+n+"-"+(s=r.data("id")),a=this.urlFor("upload"),l=function(e){return function(t){return e.postMathJaxProcessor(edx.HtmlUtils.HTML(t)).toString()}},o=Markdown.makeWmdEditor(r,i,a,l(this)),this.wmdEditors[n+"-"+s]=o,d&&r.find("#wmd-input"+i).attr("placeholder",d),o},e.getWmdEditor=function(e,t,n){var i;return i=t("."+n).attr("data-id"),this.wmdEditors[n+"-"+i]},e.getWmdInput=function(e,t,n){var i;return i=t("."+n),t("#wmd-input-"+n+"-"+i.attr("data-id"))},e.getWmdContent=function(e,t,n){return this.getWmdInput(e,t,n).val()},e.setWmdContent=function(e,t,n,i){return this.getWmdInput(e,t,n).val(i),this.getWmdEditor(e,t,n).refreshPreview()};var t=/^([^\$]*?)\$\$([^\$]*?)\$\$(.*)$/m,n=/^([^\$]*?)\$([^\$]+?)\$(.*)$/m,i="@@ESCAPED_D@@",o="@@ESCAPED_B@@";return e.processEachMathAndCode=function(e,r){var s,a,d,l;for(a={},d="",(s=edx.HtmlUtils.setHtml($("<div>"),edx.HtmlUtils.ensureHtml(e))).find("code").each(function(e,t){return a[e]=$(t).html(),$(t).text(e)}),l=(l=s.html()).replace(/\\\$/g,i);;)if(n.test(l))l=l.replace(n,function(e,t,n,i){return d+=t+r("$"+n+"$","inline"),i});else{if(!t.test(l)){d+=l;break}l=l.replace(t,function(e,t,n,i){return d+=t+r("$$"+n+"$$","display"),i})}return l=(l=(l=(l=(l=(l=d).replace(new RegExp(i,"g"),"\\$")).replace(/\\\\\\\\/g,o)).replace(/\\begin\{([a-z]*\*?)\}([\s\S]*?)\\end\{\1\}/gim,function(e,t,n){return r("\\begin{"+t+"}"+n+"\\end{"+t+"}")})).replace(new RegExp(o,"g"),"\\\\\\\\")).replace(new RegExp("{javascript:(.+?)}","g"),"{}"),(s=edx.HtmlUtils.setHtml($("<div>"),edx.HtmlUtils.HTML(l))).find("code").each(function(e,t){edx.HtmlUtils.setHtml($(t),edx.HtmlUtils.HTML(r(a[e],"code")))}),edx.HtmlUtils.HTML(s.html())},e.unescapeHighlightTag=function(e){return edx.HtmlUtils.HTML(e.toString().replace(/\&lt\;highlight\&gt\;/g,"<span class='search-highlight'>").replace(/\&lt\;\/highlight\&gt\;/g,"</span>"))},e.stripHighlight=function(e){return e.replace(/\&(amp\;)?lt\;highlight\&(amp\;)?gt\;/g,"").replace(/\&(amp\;)?lt\;\/highlight\&(amp\;)?gt\;/g,"")},e.stripLatexHighlight=function(e){return this.processEachMathAndCode(e,this.stripHighlight)},e.markdownWithHighlight=function(e){var t;e=e.replace(/^\&gt\;/gm,">"),t=Markdown.getMathCompatibleConverter();var n=edx.HtmlUtils.HTML(t.makeHtml(e));return this.unescapeHighlightTag(this.stripLatexHighlight(n))},e.abbreviateString=function(e,t){if(e.length<t)return e;for(;t<e.length&&" "!==e[t];)t++;return e.substr(0,t)+gettext("…")},e.convertMath=function(e){edx.HtmlUtils.setHtml(e,this.postMathJaxProcessor(this.markdownWithHighlight(e.text())))},e.typesetMathJax=function(e){"undefined"!=typeof MathJax&&null!==MathJax&&void 0!==MathJax.Hub&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,e[0]])},e.abbreviateHTML=function(e,t){var n,i,o;o=edx.HtmlUtils.HTML(jQuery.truncate(e.toString(),{length:t,noBreaks:!0,ellipsis:gettext("…")})),(i=(n=$(edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML("<div>"),o,edx.HtmlUtils.HTML("</div>")).toString())).find("img:not(:first)")).length>0&&edx.HtmlUtils.append(n,edx.HtmlUtils.interpolateHtml(edx.HtmlUtils.HTML("<p><em>{text}</em></p>"),{text:gettext("Some images in this post have been omitted")}));var r=edx.HtmlUtils.interpolateHtml(edx.HtmlUtils.HTML("<em>{text}</em>"),{text:gettext("image omitted")});return i.after(edx.HtmlUtils.ensureHtml(r).toString()).remove(),n.html()},e.getPaginationParams=function(e,t,n){var i,o,r;return o=Math.max(e-2,1),i=Math.min(e+2,t),r=function(e){return{number:e,url:n(e)}},{page:e,lowPages:_.range(o,e).map(r),highPages:_.range(e+1,i+1).map(r),previous:e>1?r(e-1):null,next:e<t?r(e+1):null,leftdots:o>2,rightdots:i<t-1,first:o>1?r(1):null,last:i<t?r(t):null}},e.handleKeypressInToolbar=function(e){var t,n,i,o,r,s,a,d;t=$(e.target),o=e.which||e.keyCode,i=t.parent().children(".wmd-button"),a=o===this.leftKey||o===this.rightKey,d=i.length>0,a&&d&&(s=i.index(t),r=o===this.leftKey?s-1:s+1,r=Math.max(Math.min(r,i.length-1),0),n=$(i[r]),this.moveSelectionToNextItem(t,n))},e.moveSelectionToNextItem=function(e,t){e.attr("aria-selected","false"),e.attr("tabindex","-1"),t.attr("aria-selected","true"),t.attr("tabindex","0"),t.focus()},e}.call(this)}).call(window)}).call(window)},760(){(function(){(function(){"use strict";var e={}.hasOwnProperty,t=function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t};"undefined"!=typeof Backbone&&null!==Backbone&&(this.DiscussionContentView=function(e){function n(){var e=this;return this.setWmdContent=function(){return n.prototype.setWmdContent.apply(e,arguments)},this.getWmdContent=function(){return n.prototype.getWmdContent.apply(e,arguments)},this.getWmdEditor=function(){return n.prototype.getWmdEditor.apply(e,arguments)},this.makeWmdEditor=function(){return n.prototype.makeWmdEditor.apply(e,arguments)},n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.events={"click .discussion-flag-abuse":"toggleFlagAbuse","keydown .discussion-flag-abuse":function(e){return DiscussionUtil.activateOnSpace(e,this.toggleFlagAbuse)}},n.prototype.attrRenderer={ability:function(e){var t,n,i,o;for(t in o=[],i=this.abilityRenderer)i.hasOwnProperty(t)&&(n=i[t],e[t]?o.push(n.enable.apply(this)):o.push(n.disable.apply(this)));return o}},n.prototype.abilityRenderer={editable:{enable:function(){return this.$(".action-edit").closest(".actions-item").removeClass("is-hidden")},disable:function(){return this.$(".action-edit").closest(".actions-item").addClass("is-hidden")}},can_delete:{enable:function(){return this.$(".action-delete").closest(".actions-item").removeClass("is-hidden")},disable:function(){return this.$(".action-delete").closest(".actions-item").addClass("is-hidden")}},can_openclose:{enable:function(){var e=this;return _.each([".action-close",".action-pin"],function(t){return e.$(t).closest(".actions-item").removeClass("is-hidden")})},disable:function(){var e=this;return _.each([".action-close",".action-pin"],function(t){return e.$(t).closest(".actions-item").addClass("is-hidden")})}},can_report:{enable:function(){return this.$(".action-report").closest(".actions-item").removeClass("is-hidden")},disable:function(){return this.$(".action-report").closest(".actions-item").addClass("is-hidden")}},can_vote:{enable:function(){this.$(".action-vote").closest(".actions-item").removeClass("is-disabled")},disable:function(){this.$(".action-vote").closest(".actions-item").addClass("is-disabled")}}},n.prototype.renderPartialAttrs=function(){var e,t,n,i;for(e in i=[],n=this.model.changedAttributes())n.hasOwnProperty(e)&&(t=n[e],this.attrRenderer[e]?i.push(this.attrRenderer[e].apply(this,[t])):i.push(void 0));return i},n.prototype.renderAttrs=function(){var e,t,n,i;for(e in i=[],n=this.model.attributes)n.hasOwnProperty(e)&&(t=n[e],this.attrRenderer[e]?i.push(this.attrRenderer[e].apply(this,[t])):i.push(void 0));return i},n.prototype.makeWmdEditor=function(e){return this.$el.find(".wmd-panel").length?null:DiscussionUtil.makeWmdEditor(this.$el,$.proxy(this.$,this),e)},n.prototype.getWmdEditor=function(e){return DiscussionUtil.getWmdEditor(this.$el,$.proxy(this.$,this),e)},n.prototype.getWmdContent=function(e){return DiscussionUtil.getWmdContent(this.$el,$.proxy(this.$,this),e)},n.prototype.setWmdContent=function(e,t){return DiscussionUtil.setWmdContent(this.$el,$.proxy(this.$,this),e,t)},n.prototype.initialize=function(){var e=this;return this.model.bind("change",this.renderPartialAttrs,this),this.listenTo(this.model,"change:endorsed",function(){e.model instanceof Comment&&e.trigger("comment:endorse")})},n}(Backbone.View),this.DiscussionContentShowView=function(e){function n(){var e=this;return this.toggleClose=function(){return n.prototype.toggleClose.apply(e,arguments)},this.toggleReport=function(){return n.prototype.toggleReport.apply(e,arguments)},this.togglePin=function(){return n.prototype.togglePin.apply(e,arguments)},this.toggleVote=function(){return n.prototype.toggleVote.apply(e,arguments)},this.toggleEndorse=function(){return n.prototype.toggleEndorse.apply(e,arguments)},this.toggleFollow=function(){return n.prototype.toggleFollow.apply(e,arguments)},this.handleSecondaryActionBlur=function(){return n.prototype.handleSecondaryActionBlur.apply(e,arguments)},this.handleSecondaryActionEscape=function(){return n.prototype.handleSecondaryActionEscape.apply(e,arguments)},this.toggleSecondaryActions=function(){return n.prototype.toggleSecondaryActions.apply(e,arguments)},this.updateButtonState=function(){return n.prototype.updateButtonState.apply(e,arguments)},n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.events=_.reduce([[".action-follow","toggleFollow"],[".action-answer","toggleEndorse"],[".action-endorse","toggleEndorse"],[".action-vote","toggleVote"],[".action-more","toggleSecondaryActions"],[".action-pin","togglePin"],[".action-edit","edit"],[".action-delete","_delete"],[".action-report","toggleReport"],[".action-close","toggleClose"]],function(e,t){var n,i;return i=t[0],n=t[1],e["click "+i]=function(e){return this[n](e)},e["keydown "+i]=function(e){return DiscussionUtil.activateOnSpace(e,this[n])},e},{}),n.prototype.updateButtonState=function(e,t){var n;return(n=this.$(e)).toggleClass("is-checked",t),n.attr("aria-checked",t)},n.prototype.attrRenderer=$.extend({},DiscussionContentView.prototype.attrRenderer,{subscribed:function(e){return this.updateButtonState(".action-follow",e)},endorsed:function(e){var t,n;return n="question"===this.model.get("thread").get("thread_type")?".action-answer":".action-endorse",this.updateButtonState(n,e),(t=this.$(n)).closest(".actions-item").toggleClass("is-hidden",!this.model.canBeEndorsed()),t.toggleClass("is-checked",e)},votes:function(e){var t,n,i,o,r;i=".action-vote",this.updateButtonState(i,window.user.voted(this.model)),t=this.$el.find(i),n=e.up_count,r=ngettext("there is currently {numVotes} vote","there are currently {numVotes} votes",n),t.find(".js-sr-vote-count").empty().text(edx.StringUtils.interpolate(r,{numVotes:n})),o=edx.StringUtils.interpolate(ngettext("{numVotes} Vote","{numVotes} Votes",n),{numVotes:n}),t.find(".vote-count").empty().text(o),this.$el.find(".display-vote .vote-count").empty().text(o)},pinned:function(e){return this.updateButtonState(".action-pin",e),this.$(".post-label-pinned").toggleClass("is-hidden",!e)},abuse_flaggers:function(){var e;return e=this.model.isFlagged(),this.updateButtonState(".action-report",e),this.$(".post-label-reported").toggleClass("is-hidden",!e)},closed:function(e){return this.updateButtonState(".action-close",e),this.$(".post-label-closed").toggleClass("is-hidden",!e),this.$(".display-vote").toggle(e)}}),n.prototype.toggleSecondaryActions=function(e){return e.preventDefault(),e.stopPropagation(),this.secondaryActionsExpanded=!this.secondaryActionsExpanded,this.$(".action-more").toggleClass("is-expanded",this.secondaryActionsExpanded),this.$(".actions-dropdown").toggleClass("is-expanded",this.secondaryActionsExpanded).attr("aria-expanded",this.secondaryActionsExpanded),this.secondaryActionsExpanded?("keydown"===e.type&&this.$(".action-list-item:first").focus(),$("body").on("click",this.toggleSecondaryActions),$("body").on("keydown",this.handleSecondaryActionEscape),this.$(".action-list-item").on("blur",this.handleSecondaryActionBlur)):($("body").off("click",this.toggleSecondaryActions),$("body").off("keydown",this.handleSecondaryActionEscape),this.$(".action-list-item").off("blur",this.handleSecondaryActionBlur))},n.prototype.handleSecondaryActionEscape=function(e){27===e.keyCode&&(this.toggleSecondaryActions(e),this.$(".action-more").focus())},n.prototype.handleSecondaryActionBlur=function(e){var t=this;return setTimeout(function(){t.secondaryActionsExpanded&&0===t.$(".actions-dropdown :focus").length&&t.toggleSecondaryActions(e)},10)},n.prototype.toggleFollow=function(e){var t,n,i;return e.preventDefault(),t=!this.model.get("subscribed"),i=this.model.urlFor(t?"follow":"unfollow"),n=t?gettext("You could not be subscribed to this post. Refresh the page and try again."):gettext("You could not be unsubscribed from this post. Refresh the page and try again."),DiscussionUtil.updateWithUndo(this.model,{subscribed:t},{url:i,type:"POST",$elem:$(e.currentTarget)},n)},n.prototype.toggleEndorse=function(e){var t,n,i,o,r=this;return e.preventDefault(),t=!this.model.get("endorsed"),o=this.model.urlFor("endorse"),i={endorsed:t,endorsement:t?{username:DiscussionUtil.getUser().get("username"),user_id:DiscussionUtil.getUser().id,time:(new Date).toISOString()}:null},n="question"===this.model.get("thread").get("thread_type")?t?gettext("This response could not be marked as an answer. Refresh the page and try again."):gettext("This response could not be unmarked as an answer. Refresh the page and try again."):t?gettext("This response could not be marked as endorsed. Refresh the page and try again."):gettext("This response could not be unendorsed. Refresh the page and try again."),DiscussionUtil.updateWithUndo(this.model,i,{url:o,type:"POST",data:{endorsed:t},$elem:$(e.currentTarget)},n,function(){return r.trigger("comment:endorse")}).always(this.trigger("comment:endorse"))},n.prototype.toggleVote=function(e){var t,n,i,o,r=this;if(e.preventDefault(),o=DiscussionUtil.getUser(),t=!o.voted(this.model),i=this.model.urlFor(t?"upvote":"unvote"),n={upvoted_ids:(t?_.union:_.difference)(o.get("upvoted_ids"),[this.model.id])},!$(e.target.closest(".actions-item")).hasClass("is-disabled"))return DiscussionUtil.updateWithUndo(o,n,{url:i,type:"POST",$elem:$(e.currentTarget)},gettext("This vote could not be processed. Refresh the page and try again.")).done(function(){return t?r.model.vote():r.model.unvote()})},n.prototype.togglePin=function(e){var t,n,i;return e.preventDefault(),t=!this.model.get("pinned"),i=this.model.urlFor(t?"pinThread":"unPinThread"),n=t?gettext("This post could not be pinned. Refresh the page and try again."):gettext("This post could not be unpinned. Refresh the page and try again."),DiscussionUtil.updateWithUndo(this.model,{pinned:t},{url:i,type:"POST",$elem:$(e.currentTarget)},n)},n.prototype.toggleReport=function(e){var t,n,i,o;return e.preventDefault(),this.model.isFlagged()?(t=!1,n=gettext("This post could not be flagged for abuse. Refresh the page and try again.")):(t=!0,n=gettext("This post could not be unflagged for abuse. Refresh the page and try again.")),o=this.model.urlFor(t?"flagAbuse":"unFlagAbuse"),i={abuse_flaggers:(t?_.union:_.difference)(this.model.get("abuse_flaggers"),[DiscussionUtil.getUser().id])},DiscussionUtil.updateWithUndo(this.model,i,{url:o,type:"POST",$elem:$(e.currentTarget)},n)},n.prototype.toggleClose=function(e){var t,n,i;return e.preventDefault(),n=(t=!this.model.get("closed"))?gettext("This post could not be closed. Refresh the page and try again."):gettext("This post could not be reopened. Refresh the page and try again."),i={closed:t},DiscussionUtil.updateWithUndo(this.model,i,{url:this.model.urlFor("close"),type:"POST",data:i,$elem:$(e.currentTarget)},n)},n.prototype.getAuthorDisplay=function(){return _.template($("#post-user-display-template").html())({username:this.model.get("username")||null,user_url:this.model.get("user_url"),is_community_ta:this.model.get("community_ta_authored"),is_staff:this.model.get("staff_authored")})},n.prototype.getEndorserDisplay=function(){var e;return(e=this.model.get("endorsement"))&&e.username?_.template($("#post-user-display-template").html())({username:e.username,user_url:DiscussionUtil.urlFor("user_profile",e.user_id),is_community_ta:DiscussionUtil.isTA(e.user_id)||DiscussionUtil.isGroupTA(e.user_id),is_staff:DiscussionUtil.isStaff(e.user_id)}):null},n}.call(this,this.DiscussionContentView))}).call(window)}).call(window)},368(){(function(){(function(){"use strict";this.DiscussionInlineView=Backbone.View.extend({events:{"click .discussion-show":"toggleDiscussion","keydown .discussion-show":function(e){return DiscussionUtil.activateOnSpace(e,this.toggleDiscussion)},"click .new-post-btn":"toggleNewPost","click .all-posts-btn":"navigateToAllPosts",keydown:"handleKeydown","keydown .new-post-btn":function(e){return DiscussionUtil.activateOnSpace(e,this.toggleNewPost)}},page_re:/\?discussion_page=(\d+)/,initialize:function(e){var t;this.$el=e.el,this.readOnly=e.readOnly,this.toggleDiscussionBtn=this.$(".discussion-show"),this.listenTo(this.model,"change",this.render),this.escKey=27,void 0!==e.startHeader?this.startHeader=e.startHeader:this.startHeader=4,t=this.page_re.exec(window.location.href),this.page=t?parseInt(t[1],10):1,this.defaultSortKey="activity",this.defaultSortOrder="desc",this.toggleDiscussion()},loadDiscussions:function(e,t){var n=this.$el.data("discussion-id"),i=DiscussionUtil.urlFor("retrieve_discussion",n)+"?page="+this.page+"&sort_key="+this.defaultSortKey+"&sort_order="+this.defaultSortOrder,o=this;DiscussionUtil.safeAjax({$elem:this.$el,$loading:this.$el,takeFocus:!1,url:i,type:"GET",dataType:"json",success:function(e,t){o.renderDiscussion(o.$el,e,t,n)},error:t})},renderDiscussion:function(e,t,n,i){var o,r=new DiscussionUser(t.user_info);e.focus(),window.user=r,DiscussionUtil.setUser(r),Content.loadContentInfos(t.annotated_content_info),DiscussionUtil.loadRoles(t.roles),this.courseSettings=new DiscussionCourseSettings(t.course_settings),this.is_commentable_divided=t.is_commentable_divided,this.discussion=new Discussion(void 0,{pages:t.num_pages}),this.discussion.reset(t.discussion_data,{silent:!1}),o=edx.HtmlUtils.template($("#inline-discussion-template").html())({threads:t.discussion_data,read_only:this.readOnly,discussionId:i}),this.$("section.discussion").length?(edx.HtmlUtils.setHtml(this.$el,o),this.$("section.discussion").replaceWith(edx.HtmlUtils.ensureHtml(o).toString())):edx.HtmlUtils.append(this.$el,o),this.threadListView=new DiscussionThreadListView({el:this.$(".inline-threads"),collection:this.discussion,courseSettings:this.courseSettings}),this.threadListView.render(),this.threadListView.on("thread:selected",_.bind(this.navigateToThread,this)),DiscussionUtil.bulkUpdateContentInfo(window.$$annotated_content_info),this.newPostForm=this.$el.find(".new-post-article"),this.newPostView=new NewPostView({el:this.newPostForm,collection:this.discussion,course_settings:this.courseSettings,topicId:i,startHeader:this.startHeader,is_commentable_divided:t.is_commentable_divided,user_group_id:t.user_group_id}),this.newPostView.render(),this.listenTo(this.newPostView,"newPost:createPost",this.onNewPostCreated),this.listenTo(this.newPostView,"newPost:cancel",this.hideNewPost),this.discussion.on("add",this.addThread),this.retrieved=!0,this.showed=!0,this.isWaitingOnNewPost&&this.newPostForm.removeClass("is-hidden").focus(),this.$(".inline-thread").addClass("is-hidden")},navigateToThread:function(e){var t=this.discussion.get(e);this.threadView=new DiscussionThreadView({el:this.$(".forum-content"),model:t,mode:"inline",startHeader:this.startHeader,courseSettings:this.courseSettings,is_commentable_divided:this.is_commentable_divided}),this.threadView.render(),this.listenTo(this.threadView.showView,"thread:_delete",this.navigateToAllPosts),this.$(".forum-nav-thread[data-id='"+e+"']").removeClass("never-read"),this.threadListView.$el.addClass("is-hidden"),this.$(".inline-thread").removeClass("is-hidden")},navigateToAllPosts:function(){this.$(".inline-thread").addClass("is-hidden"),this.threadView&&(this.threadView.$el.empty().off(),this.threadView.stopListening(),this.threadView=null),this.threadListView.$el.removeClass("is-hidden"),this.threadListView.$(".is-active").focus()},hideDiscussion:function(){this.$("section.discussion").addClass("is-hidden"),this.toggleDiscussionBtn.removeClass("shown"),this.toggleDiscussionBtn.find(".button-text").text(gettext("Show Discussion")),this.showed=!1},toggleDiscussion:function(){var e=this;this.showed?this.hideDiscussion():(this.toggleDiscussionBtn.addClass("shown"),this.toggleDiscussionBtn.find(".button-text").text(gettext("Hide Discussion")),this.retrieved?(this.$("section.discussion").removeClass("is-hidden"),this.showed=!0):this.loadDiscussions(this.$el,function(t){403===t.status&&t.responseText?(DiscussionUtil.discussionAlert(gettext("Warning"),t.responseText),e.$el.text(t.responseText),e.showed=!0):(e.hideDiscussion(),DiscussionUtil.discussionAlert(gettext("Error"),gettext("This discussion could not be loaded. Refresh the page and try again.")))}))},toggleNewPost:function(e){if(e.preventDefault(),!this.newPostForm)return this.toggleDiscussion(),void(this.isWaitingOnNewPost=!0);this.showed&&(this.$("section.discussion").find(".inline-discussion-thread-container").addClass("is-hidden"),this.$("section.discussion").find(".add_post_btn_container").addClass("is-hidden"),this.newPostForm.removeClass("is-hidden")),this.newPostView.$el.removeClass("is-hidden"),this.toggleDiscussionBtn.addClass("shown"),this.toggleDiscussionBtn.find(".button-text").text(gettext("Hide Discussion")),this.showed=!0},onNewPostCreated:function(){this.navigateToAllPosts(),this.hideNewPost()},hideNewPost:function(){this.$("section.discussion").find(".inline-discussion-thread-container").removeClass("is-hidden"),this.$("section.discussion").find(".add_post_btn_container").removeClass("is-hidden").focus(),this.newPostForm.addClass("is-hidden")},handleKeydown:function(e){e.keyCode===this.escKey&&this.$("section.discussion").find(".cancel").trigger("click")}})}).call(window)}).call(window)},156(){(function(){(function(){"use strict";Backbone&&(this.DiscussionThreadEditView=Backbone.View.extend({tagName:"form",events:{submit:"updateHandler","click .post-cancel":"cancelHandler","keypress input:not(.wmd-input)":function(e){return DiscussionUtil.ignoreEnterKey(e)}},attributes:{class:"discussion-post edit-post-form"},initialize:function(e){return this.container=e.container||$(".thread-content-wrapper"),this.mode=e.mode||"inline",this.startHeader=e.startHeader,this.course_settings=e.course_settings,this.threadType=this.model.get("thread_type"),this.topicId=this.model.get("commentable_id"),this.context=e.context||"course",_.bindAll(this,"updateHandler","cancelHandler"),this},render:function(){var e,t=_.uniqueId("form-"),n=edx.HtmlUtils.template($("#thread-type-template").html()),i=$(n({form_id:t}).toString()),o=edx.HtmlUtils.template($("#thread-edit-template").html());return e=$.extend({mode:this.mode,startHeader:this.startHeader},this.model.attributes),edx.HtmlUtils.setHtml(this.$el,o(e)),this.container.append(this.$el),this.$submitBtn=this.$(".post-update"),this.addField(i),this.$("#"+t+"-post-type-"+this.threadType).attr("checked",!0),this.isTabMode()&&(this.topicView=new DiscussionTopicMenuView({topicId:this.topicId,course_settings:this.course_settings}),this.addField(this.topicView.render())),DiscussionUtil.makeWmdEditor(this.$el,$.proxy(this.$,this),"edit-post-body"),this},addField:function(e){return this.$(".forum-edit-post-form-wrapper").append(e),this},isTabMode:function(){return"tab"===this.mode},save:function(){var e=this.$(".edit-post-title").val(),t=this.$(".input-radio:checked").val(),n=this.$(".edit-post-body textarea").val(),i={title:e,thread_type:t,body:n};return this.topicView&&(i.commentable_id=this.topicView.getCurrentTopicId()),DiscussionUtil.safeAjax({$elem:this.$submitBtn,$loading:this.$submitBtn,url:DiscussionUtil.urlFor("update_thread",this.model.id),type:"POST",dataType:"json",data:i,error:DiscussionUtil.formErrorHandler(this.$(".post-errors")),success:function(){this.$(".edit-post-title").val("").attr("prev-text",""),this.$(".edit-post-body textarea").val("").attr("prev-text",""),this.$(".wmd-preview p").html(""),this.topicView&&(i.courseware_title=this.topicView.getFullTopicName()),this.model.set(i).unset("abbreviatedBody"),this.trigger("thread:updated"),this.threadType!==t&&(this.model.set("thread_type",t),this.model.trigger("thread:thread_type_updated"),this.trigger("comment:endorse"))}.bind(this)})},updateHandler:function(e){return e.preventDefault(),this.trigger("thread:update",e),this.save(),this},cancelHandler:function(e){return e.preventDefault(),this.trigger("thread:cancel_edit",e),this.remove(),this}}))}).call(window)}).call(window)},556(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.DiscussionThreadListView=function(t){function n(){var e=this;return this.updateEmailNotifications=function(){return n.prototype.updateEmailNotifications.apply(e,arguments)},this.retrieveFollowed=function(){return n.prototype.retrieveFollowed.apply(e,arguments)},this.chooseGroup=function(){return n.prototype.chooseGroup.apply(e,arguments)},this.chooseFilter=function(){return n.prototype.chooseFilter.apply(e,arguments)},this.threadRemoved=function(){return n.prototype.threadRemoved.apply(e,arguments)},this.threadSelected=function(){return n.prototype.threadSelected.apply(e,arguments)},this.renderThread=function(){return n.prototype.renderThread.apply(e,arguments)},this.loadMorePages=function(){return n.prototype.loadMorePages.apply(e,arguments)},this.showMetadataAccordingToSort=function(){return n.prototype.showMetadataAccordingToSort.apply(e,arguments)},this.renderThreads=function(){return n.prototype.renderThreads.apply(e,arguments)},this.addAndSelectThread=function(){return n.prototype.addAndSelectThread.apply(e,arguments)},this.reloadDisplayedCollection=function(){return n.prototype.reloadDisplayedCollection.apply(e,arguments)},this.clearSearchAlerts=function(){return n.prototype.clearSearchAlerts.apply(e,arguments)},this.removeSearchAlert=function(){return n.prototype.removeSearchAlert.apply(e,arguments)},this.addSearchAlert=function(){return n.prototype.addSearchAlert.apply(e,arguments)},this.performSearch=function(){return n.prototype.performSearch.apply(e,arguments)},n.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(n,t),n.prototype.events={"keypress .forum-nav-browse-filter-input":function(e){return DiscussionUtil.ignoreEnterKey(e)},"change .forum-nav-sort-control":"sortThreads","click .forum-nav-thread-link":"threadSelected","click .forum-nav-load-more-link":"loadMorePages","change .forum-nav-filter-main-control":"chooseFilter","change .forum-nav-filter-cohort-control":"chooseGroup"},n.prototype.initialize=function(e){var t=this;this.courseSettings=e.courseSettings,this.supportsActiveThread=e.supportsActiveThread,this.hideReadState=e.hideReadState||!1,this.displayedCollection=new Discussion(this.collection.models,{pages:this.collection.pages}),this.collection.on("change",this.reloadDisplayedCollection),this.discussionIds=this.$el.data("discussion-id")||"",this.collection.on("reset",function(e){return t.displayedCollection.current_page=e.current_page,t.displayedCollection.pages=e.pages,t.displayedCollection.reset(e.models)}),this.collection.on("add",this.addAndSelectThread),this.collection.on("thread:remove",this.threadRemoved),this.sidebar_padding=10,this.boardName=null,this.current_search="",this.mode=e.mode||"commentables",this.showThreadPreview=!0,this.searchAlertCollection=new Backbone.Collection([],{model:Backbone.Model}),this.searchAlertCollection.on("add",function(e){var n;return n=edx.HtmlUtils.template($("#search-alert-template").html())({messageHtml:e.attributes.message,cid:e.cid,css_class:e.attributes.css_class}),edx.HtmlUtils.append(t.$(".search-alerts"),n),t.$("#search-alert-"+e.cid+" .dismiss").bind("click",e,function(e){return t.removeSearchAlert(e.data.cid)})}),this.searchAlertCollection.on("remove",function(e){return t.$("#search-alert-"+e.cid).remove()}),this.searchAlertCollection.on("reset",function(){return t.$(".search-alerts").empty()}),this.template=edx.HtmlUtils.template($("#thread-list-template").html()),this.threadListItemTemplate=edx.HtmlUtils.template($("#thread-list-item-template").html())},n.prototype.addSearchAlert=function(e,t){var n=new Backbone.Model({message:e,css_class:t||""});return this.searchAlertCollection.add(n),n},n.prototype.removeSearchAlert=function(e){return this.searchAlertCollection.remove(e)},n.prototype.clearSearchAlerts=function(){return this.searchAlertCollection.reset()},n.prototype.reloadDisplayedCollection=function(e){var t,n,i,o;this.clearSearchAlerts(),o=e.get("id"),n=this.renderThread(e),t=0!==(i=this.$(".forum-nav-thread[data-id="+o+"]")).has(".forum-nav-thread-link.is-active").length,i.replaceWith(n),this.showMetadataAccordingToSort(),this.supportsActiveThread&&t&&this.setActiveThread(o)},n.prototype.addAndSelectThread=function(e){var t=e.get("commentable_id"),n=this;return this.retrieveDiscussion(t,function(){return n.trigger("thread:created",e.get("id"))})},n.prototype.ignoreClick=function(e){return e.stopPropagation()},n.prototype.render=function(){var e=this;return this.timer=0,this.$el.empty(),edx.HtmlUtils.append(this.$el,this.template({isDiscussionDivisionEnabled:this.courseSettings.get("is_discussion_division_enabled"),isPrivilegedUser:DiscussionUtil.isPrivilegedUser()})),this.hideReadState&&this.$(".forum-nav-filter-main").addClass("is-hidden"),this.$(".forum-nav-sort-control option").removeProp("selected"),this.$(".forum-nav-sort-control option[value="+this.collection.sort_preference+"]").prop("selected",!0),this.displayedCollection.on("reset",this.renderThreads),this.displayedCollection.on("thread:remove",this.renderThreads),this.displayedCollection.on("change:commentable_id",function(){"commentables"===e.mode&&e.retrieveDiscussions(e.discussionIds.split(","))}),this.renderThreads(),this},n.prototype.renderThreads=function(){var e,t,n,i;for(this.$(".forum-nav-thread-list").empty(),n=0,i=this.displayedCollection.models.length;n<i;n++)t=this.displayedCollection.models[n],e=this.renderThread(t),this.$(".forum-nav-thread-list").append(e);0===this.$(".forum-nav-thread-list li").length&&(this.clearSearchAlerts(),this.addSearchAlert(gettext("There are no posts in this topic yet."))),this.showMetadataAccordingToSort(),this.renderMorePages(),this.trigger("threads:rendered")},n.prototype.showMetadataAccordingToSort=function(){var e=this.$(".forum-nav-thread-votes-count"),t=this.$(".forum-nav-thread-unread-comments-count"),n=this.$(".forum-nav-thread-comments-count");e.hide(),n.hide(),t.hide(),"votes"===this.$(".forum-nav-sort-control").val()?e.show():(t.show(),n.show())},n.prototype.renderMorePages=function(){this.displayedCollection.hasMorePages()&&edx.HtmlUtils.append(this.$(".forum-nav-thread-list"),edx.HtmlUtils.template($("#nav-load-more-link").html())({}))},n.prototype.getLoadingContent=function(e){return edx.HtmlUtils.template($("#nav-loading-template").html())({srText:e})},n.prototype.loadMorePages=function(e){var t,n,i,o,r,s,a=this;switch(e&&e.preventDefault(),(i=this.$(".forum-nav-load-more")).empty(),edx.HtmlUtils.append(i,this.getLoadingContent(gettext("Loading more threads"))),o=i.find(".forum-nav-loading"),DiscussionUtil.makeFocusTrap(o),o.focus(),r={filter:this.filter},this.mode){case"search":r.search_text=this.current_search,this.group_id&&(r.group_id=this.group_id);break;case"followed":r.user_id=window.user.id;break;case"user":r.user_id=this.$el.parent().data("user-id");break;case"commentables":r.commentable_ids=this.discussionIds,this.group_id&&(r.group_id=this.group_id);break;case"all":this.group_id&&(r.group_id=this.group_id)}return s=this.collection.last(),(n=s?s.get("id"):void 0)?this.once("threads:rendered",function(){return $(".forum-nav-thread[data-id='"+n+"'] + .forum-nav-thread .forum-nav-thread-link").focus()}):this.once("threads:rendered",function(){var e=$(".forum-nav-thread-link").first();return e?e.focus():void 0}),t=function(){a.renderThreads(),DiscussionUtil.discussionAlert(gettext("Error"),gettext("Additional posts could not be loaded. Refresh the page and try again."))},this.collection.retrieveAnotherPage(this.mode,r,{sort_key:this.$(".forum-nav-sort-control").val()},t)},n.prototype.containsMarkup=function(e){var t=-1!==e.indexOf("!["),n=(e.match(/\$/g)||[]).length>1;return t||n},n.prototype.renderThread=function(e){var t=e.get("comments_count"),n=e.get("unread_comments_count"),i=!e.get("read")&&n===t,o=this.containsMarkup(e.get("body"))?"":e.get("body"),r=_.extend({neverRead:i,threadUrl:e.urlFor("retrieve"),threadPreview:o,showThreadPreview:this.showThreadPreview,hideReadState:this.hideReadState},e.toJSON()),s=$(this.threadListItemTemplate(r).toString()),a=s.find(".thread-preview-body").text();return a=(new DOMParser).parseFromString(a,"text/html").documentElement.textContent,s.find(".thread-preview-body").text(a),s},n.prototype.threadSelected=function(e){var t;return t=$(e.target).closest(".forum-nav-thread").attr("data-id"),this.supportsActiveThread&&this.setActiveThread(t),this.trigger("thread:selected",t),!1},n.prototype.threadRemoved=function(e){this.trigger("thread:removed",e)},n.prototype.setActiveThread=function(e){var t;this.$(".forum-nav-thread-link").find(".sr").remove(),this.$(".forum-nav-thread[data-id!='"+e+"'] .forum-nav-thread-link").removeClass("is-active"),t=edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML('<span class="sr">'),edx.HtmlUtils.ensureHtml(gettext("Current conversation")),edx.HtmlUtils.HTML("</span>")).toString(),this.$(".forum-nav-thread[data-id='"+e+"'] .forum-nav-thread-link").addClass("is-active").find(".forum-nav-thread-wrapper-1").prepend(t)},n.prototype.selectTopic=function(e){var t,n;return(n=e.closest(".forum-nav-browse-menu-item")).hasClass("forum-nav-browse-menu-all")?(this.discussionIds="",this.$(".forum-nav-filter-cohort").show(),this.retrieveAllThreads()):n.hasClass("forum-nav-browse-menu-following")?(this.retrieveFollowed(),this.$(".forum-nav-filter-cohort").hide()):(t=n.find(".forum-nav-browse-menu-item").andSelf().filter("[data-discussion-id]").map(function(e,t){return $(t).data("discussion-id")}).get(),this.retrieveDiscussions(t),this.$(".forum-nav-filter-cohort").toggle(!0===n.data("divided")))},n.prototype.chooseFilter=function(){return this.filter=$(".forum-nav-filter-main-control :selected").val(),this.clearSearchAlerts(),this.retrieveFirstPage()},n.prototype.chooseGroup=function(){return this.group_id=this.$(".forum-nav-filter-cohort-control :selected").val(),this.retrieveFirstPage()},n.prototype.retrieveDiscussion=function(e,t){var n=DiscussionUtil.urlFor("retrieve_discussion",e),i=this;return DiscussionUtil.safeAjax({url:n,type:"GET",success:function(e){i.collection.current_page=e.page,i.collection.pages=e.num_pages,i.collection.reset(e.discussion_data),Content.loadContentInfos(e.annotated_content_info),i.displayedCollection.reset(i.collection.models),t&&t()}})},n.prototype.retrieveDiscussions=function(e){return this.discussionIds=e.join(","),this.mode="commentables",this.retrieveFirstPage()},n.prototype.retrieveAllThreads=function(){return this.mode="all",this.retrieveFirstPage()},n.prototype.retrieveFirstPage=function(e){return this.collection.current_page=0,this.$(".forum-nav-thread-list").empty(),this.collection.models=[],this.loadMorePages(e)},n.prototype.sortThreads=function(e){return this.displayedCollection.setSortComparator(this.$(".forum-nav-sort-control").val()),this.retrieveFirstPage(e)},n.prototype.performSearch=function(e){this.trigger("search:initiated"),this.searchFor(e.val(),e)},n.prototype.searchFor=function(e,t){var n=DiscussionUtil.urlFor("search"),i=this;return this.clearSearchAlerts(),this.clearFilters(),this.mode="search",this.current_search=e,DiscussionUtil.safeAjax({$elem:t,data:{text:e},url:n,type:"GET",dataType:"json",$loading:$,loadingCallback:function(){var e=i.$(".forum-nav-thread-list");e.empty(),edx.HtmlUtils.append(e,edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML("<li class='forum-nav-load-more'>"),i.getLoadingContent(gettext("Loading posts list")),edx.HtmlUtils.HTML("</li>")))},loadedCallback:function(){return i.$(".forum-nav-thread-list .forum-nav-load-more").remove()},success:function(t,n){var o,r;return"success"===n&&(i.collection.reset(t.discussion_data),i.clearSearchAlerts(),Content.loadContentInfos(t.annotated_content_info),i.collection.current_page=t.page,i.collection.pages=t.num_pages,_.isNull(t.corrected_text)?0===t.discussion_data.length&&(i.addSearchAlert(gettext("No posts matched your query.")),i.displayedCollection.models=[]):(r=_.escape(gettext("No results found for {original_query}. Showing results for {suggested_query}.")),o=edx.HtmlUtils.interpolateHtml(r,{original_query:edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML("<em>"),e,edx.HtmlUtils.HTML("</em>")),suggested_query:edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML("<em>"),t.corrected_text,edx.HtmlUtils.HTML("</em>"))}),i.addSearchAlert(o)),0!==i.collection.models.length&&i.displayedCollection.reset(i.collection.models),e)?i.searchForUser(e):t}})},n.prototype.searchForUser=function(e){var t=this;return DiscussionUtil.safeAjax({data:{username:e},url:DiscussionUtil.urlFor("users"),type:"GET",dataType:"json",error:function(){},success:function(e){var n,i;e.users.length>0&&(i=edx.HtmlUtils.joinHtml(edx.HtmlUtils.interpolateHtml(edx.HtmlUtils.HTML('<a class="link-jump" href="{url}">'),{url:DiscussionUtil.urlFor("user_profile",e.users[0].id)}),e.users[0].username,edx.HtmlUtils.HTML("</a>")),n=edx.HtmlUtils.interpolateHtml(gettext("Show posts by {username}."),{username:i}),t.addSearchAlert(n,"search-by-user"))}})},n.prototype.clearFilters=function(){return this.$(".forum-nav-filter-main-control").val("all"),this.$(".forum-nav-filter-cohort-control").val("all")},n.prototype.retrieveFollowed=function(){return this.mode="followed",this.retrieveFirstPage()},n.prototype.updateEmailNotifications=function(){var e,t,n;e=$("input.email-setting"),n=(t=e.prop("checked"))?"enable_notifications":"disable_notifications",DiscussionUtil.safeAjax({url:DiscussionUtil.urlFor(n),type:"POST",error:function(){e.prop("checked",!t)}})},n}.call(this,Backbone.View))}).call(window)}).call(window)},669(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.DiscussionThreadProfileView=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,Backbone.View),t.prototype.render=function(){var e;return this.convertMath(),this.abbreviateBody(),e=$.extend(this.model.toJSON(),{permalink:this.model.urlFor("retrieve")}),this.model.get("anonymous")||(e=$.extend(e,{user:{username:this.model.username,user_url:this.model.user_url}})),edx.HtmlUtils.setHtml(this.$el,edx.HtmlUtils.template($("#profile-thread-template").html())(e)),this.$("span.timeago").timeago(),DiscussionUtil.typesetMathJax(this.$(".post-body")),this},t.prototype.convertMath=function(){var e=DiscussionUtil.markdownWithHighlight(this.model.get("body"));this.model.set("markdownBody",e)},t.prototype.abbreviateBody=function(){var e;e=DiscussionUtil.abbreviateHTML(this.model.get("markdownBody"),140),this.model.set("abbreviatedBody",e)},t}())}).call(window)}).call(window)},935(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.DiscussionThreadShowView=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,DiscussionContentShowView),t.prototype.initialize=function(e){var n;if(t.__super__.initialize.call(this),this.mode=e.mode||"inline",this.startHeader=e.startHeader,this.is_commentable_divided=e.is_commentable_divided,"tab"!==(n=this.mode)&&"inline"!==n)throw new Error("invalid mode: "+this.mode)},t.prototype.renderTemplate=function(){var e=$.extend({mode:this.mode,startHeader:this.startHeader,flagged:this.model.isFlagged(),is_commentable_divided:this.is_commentable_divided,author_display:this.getAuthorDisplay(),cid:this.model.cid,readOnly:$(".discussion-module").data("read-only")},this.model.attributes);return edx.HtmlUtils.template($("#thread-show-template").html())(e)},t.prototype.render=function(){return edx.HtmlUtils.setHtml(this.$el,this.renderTemplate()),this.delegateEvents(),this.renderAttrs(),this.$("span.timeago").timeago(),this.convertMath(),this},t.prototype.convertMath=function(){DiscussionUtil.convertMath(this.$(".post-body")),DiscussionUtil.typesetMathJax(this.$(".post-body"))},t.prototype.edit=function(e){return this.trigger("thread:edit",e)},t.prototype._delete=function(e){return this.trigger("thread:_delete",e)},t}())}).call(window)}).call(window)},411(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.DiscussionThreadView=function(){function t(){var e=this;return this._delete=function(){return t.prototype._delete.apply(e,arguments)},this.closeEditView=function(){return t.prototype.closeEditView.apply(e,arguments)},this.edit=function(){return t.prototype.edit.apply(e,arguments)},this.endorseThread=function(){return t.prototype.endorseThread.apply(e,arguments)},this.addComment=function(){return t.prototype.addComment.apply(e,arguments)},this.renderAddResponseButton=function(){return t.prototype.renderAddResponseButton.apply(e,arguments)},this.renderResponseToList=function(){return t.prototype.renderResponseToList.apply(e,arguments)},this.renderResponseCountAndPagination=function(){return t.prototype.renderResponseCountAndPagination.apply(e,arguments)},t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,DiscussionContentView),t.prototype.events={"click .discussion-submit-post":"submitComment","click .add-response-btn":"scrollToAddResponse","keydown .wmd-button":function(e){return DiscussionUtil.handleKeypressInToolbar(e)}},t.prototype.$=function(e){return this.$el.find(e)},t.prototype.isQuestion=function(){return"question"===this.model.get("thread_type")},t.prototype.initialize=function(e){var n,i=this;if(t.__super__.initialize.call(this),this.mode=e.mode||"inline",this.context=e.context||"course",this.options=_.extend({},e),this.startHeader=e.startHeader,"tab"!==(n=this.mode)&&"inline"!==n)throw new Error("invalid mode: "+this.mode);this.readOnly=$(".discussion-module").data("read-only"),this.model.collection.on("reset",function(e){var t;t=i.model.get("id"),e.get(t)&&(i.model=e.get(t))}),this.is_commentable_divided=e.is_commentable_divided,this.createShowView(),this.responses=new Comments,this.loadedResponses=!1,this.isQuestion()&&(this.markedAnswers=new Comments)},t.prototype.rerender=function(){return this.showView&&this.showView.undelegateEvents(),this.undelegateEvents(),this.$el.empty(),this.initialize({mode:this.mode,model:this.model,el:this.el,courseSettings:this.options.courseSettings,topicId:this.topicId}),this.render()},t.prototype.renderTemplate=function(){var e,t;return this.template=_.template($("#thread-template").html()),(e=$("#discussion-container")).length||(e=$(".discussion-module")),t=_.extend(this.model.toJSON(),{readOnly:this.readOnly,startHeader:this.startHeader+1,can_create_comment:e.data("user-create-comment")}),this.template(t)},t.prototype.render=function(){var e=this,t=$(this.renderTemplate());this.$el.empty(),this.$el.append(t),this.delegateEvents(),this.renderShowView(),this.renderAttrs(),this.$("span.timeago").timeago(),this.makeWmdEditor("reply-body"),this.renderAddResponseButton(),this.responses.on("add",function(t){return e.renderResponseToList(t,".js-response-list",{})}),this.isQuestion()&&this.markedAnswers.on("add",function(t){return e.renderResponseToList(t,".js-marked-answer-list",{collapseComments:!0})}),this.loadInitialResponses()},t.prototype.attrRenderer=$.extend({},DiscussionContentView.prototype.attrRenderer,{closed:function(e){return this.$(".discussion-reply-new").toggle(!e),this.$(".comment-form").closest("li").toggle(!e),this.$(".action-vote").toggle(!e),this.$(".display-vote").toggle(e),this.renderAddResponseButton()}}),t.prototype.cleanup=function(){if(this.responsesRequest&&this.responsesRequest.abort)return this.responsesRequest.abort()},t.prototype.loadResponses=function(e,t,n){var i=this;this.responsesRequest=DiscussionUtil.safeAjax({url:DiscussionUtil.urlFor("retrieve_single_thread",this.model.get("commentable_id"),this.model.id),data:{resp_skip:this.responses.size(),resp_limit:e||void 0},$elem:t,$loading:t,takeFocus:!1,complete:function(){i.responsesRequest=null},success:function(e){Content.loadContentInfos(e.annotated_content_info),i.isQuestion()&&i.markedAnswers.add(e.content.endorsed_responses),i.responses.add(i.isQuestion()?e.content.non_endorsed_responses:e.content.children),i.renderResponseCountAndPagination(i.isQuestion()?e.content.non_endorsed_resp_total:e.content.resp_total),i.trigger("thread:responses:rendered"),i.loadedResponses=!0},error:function(e,t){"abort"!==t&&(404===e.status?DiscussionUtil.discussionAlert(gettext("Error"),gettext("The post you selected has been deleted.")):n?DiscussionUtil.discussionAlert(gettext("Error"),gettext("Responses could not be loaded. Refresh the page and try again.")):DiscussionUtil.discussionAlert(gettext("Error"),gettext("Additional responses could not be loaded. Refresh the page and try again.")))}})},t.prototype.loadInitialResponses=function(){return this.loadResponses(25,this.$el.find(".js-response-list"),!0)},t.prototype.renderResponseCountAndPagination=function(e){var t,n,i,o,r,s,a,d=this;if(this.isQuestion()&&0!==this.markedAnswers.length?(i=ngettext("{numResponses} other response","{numResponses} other responses",e),0===e&&this.$el.find(".response-count").hide()):i=ngettext("{numResponses} response","{numResponses} responses",e),this.$el.find(".response-count").text(edx.StringUtils.interpolate(i,{numResponses:e},!0)),(r=this.$el.find(".response-pagination")).empty(),e>0){if(a=0===(s=e-this.responses.size())?gettext("Showing all responses"):edx.StringUtils.interpolate(ngettext("Showing first response","Showing first {numResponses} responses",this.responses.size()),{numResponses:this.responses.size()},!0),r.append($("<span>").addClass("response-display-count").text(a)),s>0)return s<100?(o=null,t=gettext("Load all responses")):(o=100,t=edx.StringUtils.interpolate(gettext("Load next {numResponses} responses"),{numResponses:o},!0)),(n=$("<button>").addClass("btn-neutral").addClass("load-response-button").text(t)).click(function(){return d.loadResponses(o,n)}),r.append(n)}else this.$el.find(".add-response").hide()},t.prototype.renderResponseToList=function(e,t,n){var i;return e.set("thread",this.model),(i=new ThreadResponseView($.extend({model:e,startHeader:this.startHeader+1},n))).on("comment:add",this.addComment),i.on("comment:endorse",this.endorseThread),i.render(),this.$el.find(t).append(i.el),i.afterInsert(),n.focusAddedResponse&&this.focusToTheAddedResponse(i.el),DiscussionUtil.typesetMathJax(i.$el),i},t.prototype.renderAddResponseButton=function(){return this.model.hasResponses()&&this.model.can("can_reply")&&!this.model.get("closed")?this.$el.find(".add-response").show():this.$el.find(".add-response").hide()},t.prototype.scrollToAddResponse=function(e){var t;return e.preventDefault(),t=$(e.target).parents("article.discussion-article").find("form.discussion-reply-new"),$("html, body").scrollTop(t.offset().top),t.find(".wmd-panel textarea").focus()},t.prototype.addComment=function(){return this.model.comment()},t.prototype.endorseThread=function(){return this.model.set("endorsed",this.$el.find(".action-answer.is-checked").length>0)},t.prototype.submitComment=function(e){var t,n,i,o;if(e.preventDefault(),i=this.model.urlFor("reply"),(t=this.getWmdContent("reply-body")).trim().length)return this.setWmdContent("reply-body",""),(n=new Comment({body:t,created_at:(new Date).toISOString(),username:window.user.get("username"),votes:{up_count:0},abuse_flaggers:[],endorsed:!1,user_id:window.user.get("id")})).set("thread",this.model.get("thread")),o=this.renderResponseToList(n,".js-response-list",{focusAddedResponse:!0}),this.model.addComment(),this.renderAddResponseButton(),DiscussionUtil.safeAjax({$elem:$(e.target),url:i,type:"POST",dataType:"json",data:{body:t},success:function(e){n.updateInfo(e.annotated_content_info),n.set(e.content),DiscussionUtil.typesetMathJax(o.$el.find(".response-body"))}})},t.prototype.focusToTheAddedResponse=function(e){return $(e).attr("tabindex","-1").focus()},t.prototype.edit=function(){return this.createEditView(),this.renderEditView()},t.prototype.createEditView=function(){return this.showView&&(this.showView.undelegateEvents(),this.showView.$el.empty(),this.showView=null),this.editView=new DiscussionThreadEditView({container:this.$(".thread-content-wrapper"),model:this.model,mode:this.mode,context:this.context,startHeader:this.startHeader,course_settings:this.options.courseSettings}),this.editView.bind("thread:updated thread:cancel_edit",this.closeEditView),this.editView.bind("comment:endorse",this.endorseThread)},t.prototype.renderSubView=function(e){return e.setElement(this.$(".thread-content-wrapper")),e.render(),e.delegateEvents()},t.prototype.renderEditView=function(){return this.editView.render()},t.prototype.createShowView=function(){return this.showView=new DiscussionThreadShowView({model:this.model,mode:this.mode,startHeader:this.startHeader,is_commentable_divided:this.is_commentable_divided}),this.showView.bind("thread:_delete",this._delete),this.showView.bind("thread:edit",this.edit)},t.prototype.renderShowView=function(){return this.renderSubView(this.showView)},t.prototype.closeEditView=function(){return this.createShowView(),this.renderShowView(),this.renderAttrs(),this.$el.find(".post-extended-content").show()},t.prototype._delete=function(e){var t,n;if(n=this.model.urlFor("_delete"),this.model.can("can_delete")&&confirm(gettext("Are you sure you want to delete this post?")))return this.model.remove(),this.showView.undelegateEvents(),this.undelegateEvents(),this.$el.empty(),t=$(e.target),DiscussionUtil.safeAjax({$elem:t,url:n,type:"POST"})},t}())}).call(window)}).call(window)},606(){(function(){(function(){"use strict";Backbone&&(this.DiscussionTopicMenuView=Backbone.View.extend({events:{"change .post-topic":"handleTopicEvent"},attributes:{class:"post-field"},initialize:function(e){return this.course_settings=e.course_settings,this.currentTopicId=e.topicId,this.group_name=e.group_name,_.bindAll(this,"handleTopicEvent"),this},render:function(){var e,t=_.clone(this.course_settings.attributes);return t.topics_html=this.renderCategoryMap(this.course_settings.get("category_map")),edx.HtmlUtils.setHtml(this.$el,edx.HtmlUtils.template($("#topic-template").html())(t)),e=this.$(".post-topic option:contains(General)"),this.getCurrentTopicId()?this.setTopic(this.$(".post-topic option").filter('[data-discussion-id="'+this.getCurrentTopicId()+'"]')):e.length>0?this.setTopic(e.first()):this.setTopic(this.$(".post-topic option").first()),this.$el},renderCategoryMap:function(e){var t=edx.HtmlUtils.template($("#new-post-menu-category-template").html()),n=edx.HtmlUtils.template($("#new-post-menu-entry-template").html()),i=_.map(e.children,function(i){var o,r="",s=i[0],a=i[1];return _.has(e.entries,s)&&"entry"===a?(o=e.entries[s],r=n({text:s,id:o.id,is_divided:o.is_divided})):r=t({text:s,entries:this.renderCategoryMap(e.subcategories[s])}),r},this);return edx.HtmlUtils.joinHtml.apply(null,i)},handleTopicEvent:function(e){return this.setTopic($("option:selected",e.target)),this},setTopic:function(e){return e.data("discussion-id")&&(this.topicText=this.getFullTopicName(e),this.currentTopicId=e.data("discussion-id"),e.prop("selected",!0),this.trigger("thread:topic_change",e)),this},getCurrentTopicId:function(){return this.currentTopicId},getFullTopicName:function(e){var t;return e?(t=e.html(),_.each(e.parents("optgroup"),function(e){t=$(e).attr("label")+" / "+t}),t):this.topicText}}))}).call(this)}).call(window)},197(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.NewPostView=function(){function t(){var e=this;return this.updateStyles=function(){return t.prototype.updateStyles.apply(e,arguments)},this.resetForm=function(){return t.prototype.resetForm.apply(e,arguments)},t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,Backbone.View),t.prototype.initialize=function(e){var t;if(this.mode=e.mode||"inline",this.startHeader=e.startHeader,"tab"!==(t=this.mode)&&"inline"!==t)throw new Error("invalid mode: "+this.mode);this.course_settings=e.course_settings,this.is_commentable_divided=e.is_commentable_divided,this.user_group_id=e.user_group_id,this.topicId=e.topicId,this.discussionBoardView=e.discussionBoardView},t.prototype.render=function(){var e,t;return e=_.clone(this.course_settings.attributes),_.extend(e,{group_options:this.getGroupOptions(),is_commentable_divided:this.is_commentable_divided,is_discussion_division_enabled:this.course_settings.get("is_discussion_division_enabled"),mode:this.mode,startHeader:this.startHeader,form_id:this.mode+(this.topicId?"-"+this.topicId:"")}),edx.HtmlUtils.setHtml(this.$el,edx.HtmlUtils.template($("#new-post-template").html())(e)),t=edx.HtmlUtils.template($("#thread-type-template").html()),$(".js-group-select").prop("disabled")&&$(".group-selector-wrapper").addClass("disabled"),this.addField(t({form_id:_.uniqueId("form-")})),this.isTabMode()?(this.topicView=new DiscussionTopicMenuView({topicId:this.topicId,course_settings:this.course_settings,group_name:this.getGroupName()}),this.topicView.on("thread:topic_change",this.toggleGroupDropdown),this.course_settings.get("is_discussion_division_enabled")&&this.topicView.on("thread:topic_change",this.updateVisibilityMessage),this.addField(edx.HtmlUtils.HTML(this.topicView.render()))):(this.group_name=this.getGroupName(),this.updateVisibilityMessage(null,this.is_commentable_divided)),DiscussionUtil.makeWmdEditor(this.$el,$.proxy(this.$,this),"js-post-body")},t.prototype.addField=function(e){return edx.HtmlUtils.append(this.$(".forum-new-post-form-wrapper"),e)},t.prototype.isTabMode=function(){return"tab"===this.mode},t.prototype.getGroupOptions=function(){var e;return this.course_settings.get("is_discussion_division_enabled")&&DiscussionUtil.isPrivilegedUser()?(e=$("#discussion-container").data("user-group-id"),_.map(this.course_settings.get("groups"),function(t){return{value:t.id,text:t.name,selected:t.id===e}})):null},t.prototype.getGroupName=function(){var e,t,n=null;return this.course_settings.get("is_discussion_division_enabled")&&((e=$("#discussion-container").data("user-group-id"))||(e=this.user_group_id),(t=this.course_settings.get("groups").find(function(t){return t.id===String(e)}))&&(n=t.name)),n},t.prototype.events={"keypress .forum-new-post-form input:not(.wmd-input)":function(e){return DiscussionUtil.ignoreEnterKey(e)},"submit .forum-new-post-form":"createPost","change .post-option-input":"postOptionChange","change .js-group-select":"groupOptionChange","click .cancel":"cancel","click  .add-post-cancel":"cancel","reset .forum-new-post-form":"updateStyles","keydown .wmd-button":function(e){return DiscussionUtil.handleKeypressInToolbar(e)}},t.prototype.toggleGroupDropdown=function(e){return e.data("divided")?($(".js-group-select").prop("disabled",!1),$(".js-group-select").val("").prop("selected",!0),$(".group-selector-wrapper").removeClass("disabled")):($(".js-group-select").val("").prop("disabled",!0),$(".group-selector-wrapper").addClass("disabled"))},t.prototype.updateVisibilityMessage=function(e,t){var n=$("#wrapper-visibility-message"),i=edx.HtmlUtils.template($("#new-post-visibility-template").html()),o=null;(e&&e.data("divided")||t)&&(o=this.group_name),edx.HtmlUtils.setHtml(n,i({group_name:o}))},t.prototype.postOptionChange=function(e){var t,n;return t=(n=$(e.target)).closest(".post-option"),n.is(":checked")?t.addClass("is-enabled"):t.removeClass("is-enabled")},t.prototype.createPost=function(e){var t,n,i,o,r,s,a,d,l,c=this;return e.preventDefault(),s=this.$(".input-radio:checked").val(),a=this.$(".js-post-title").val(),i=this.$(".js-post-body").find(".wmd-input").val(),r=this.$(".js-group-select option:selected").attr("value"),t=this.$("input[name=anonymous]").is(":checked"),n=this.$("input[name=anonymous_to_peers]").is(":checked"),o=this.$("input[name=follow]").is(":checked"),d=this.isTabMode()?this.topicView.getCurrentTopicId():this.topicId,l=DiscussionUtil.urlFor("create_thread",d),DiscussionUtil.safeAjax({$elem:$(e.target),$loading:e?$(e.target):void 0,url:l,type:"POST",dataType:"json",data:{thread_type:s,title:a,body:i,anonymous:t,anonymous_to_peers:n,auto_subscribe:o,group_id:r},error:DiscussionUtil.formErrorHandler(this.$(".post-errors")),success:function(e){var t,n;return t=new Thread(e.content),c.discussionBoardView&&((n=c.discussionBoardView.breadcrumbs.model).get("contents").length&&n.set("contents",c.topicView.topicText.split("/")),c.discussionBoardView.discussionThreadListView.discussionIds=c.topicView.currentTopicId),c.$el.addClass("is-hidden"),c.resetForm(),c.trigger("newPost:createPost"),c.collection.add(t)}})},t.prototype.formModified=function(){var e=""!==this.$(".js-post-body").find(".wmd-input").val(),t=""!==this.$(".js-post-title").val();return e||t},t.prototype.cancel=function(e){e.preventDefault(),this.formModified()&&!confirm(gettext("Your post will be discarded."))||(this.trigger("newPost:cancel"),this.resetForm())},t.prototype.resetForm=function(){var e;this.$(".forum-new-post-form")[0].reset(),DiscussionUtil.clearFormErrors(this.$(".post-errors")),this.$(".wmd-preview").html(""),this.isTabMode()&&(e=this.$(".post-topic option:contains(General)"),this.topicView.setTopic(e||this.$("button.topic-title").first()))},t.prototype.updateStyles=function(){var e=this;return setTimeout(function(){return e.$(".post-option-input").trigger("change")},1)},t.prototype.groupOptionChange=function(e){var t=$(e.target),n=t.data();this.group_name=this.$(".js-group-select option:selected").text(),n.divided=!0,this.updateVisibilityMessage(t)},t}())}).call(window)}).call(window)},534(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.ResponseCommentEditView=function(){function t(e){return this.options=e,t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,Backbone.View),t.prototype.events={"click .post-update":"update","click .post-cancel":"cancel_edit"},t.prototype.$=function(e){return this.$el.find(e)},t.prototype.initialize=function(){return t.__super__.initialize.call(this)},t.prototype.render=function(){var e=$.extend({mode:this.options.mode,startHeader:this.options.startHeader},this.model.attributes);return this.template=edx.HtmlUtils.template($("#response-comment-edit-template").html()),edx.HtmlUtils.setHtml(this.$el,this.template(e)),this.delegateEvents(),DiscussionUtil.makeWmdEditor(this.$el,$.proxy(this.$,this),"edit-comment-body"),this},t.prototype.update=function(e){return this.trigger("comment:update",e)},t.prototype.cancel_edit=function(e){return this.trigger("comment:cancel_edit",e)},t}())}).call(window)}).call(window)},61(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.ResponseCommentShowView=function(){function t(){var e=this;return this.edit=function(){return t.prototype.edit.apply(e,arguments)},this._delete=function(){return t.prototype._delete.apply(e,arguments)},t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,DiscussionContentShowView),t.prototype.tagName="li",t.prototype.render=function(){var e=edx.HtmlUtils.template($("#response-comment-show-template").html()),t=_.extend({cid:this.model.cid,author_display:this.getAuthorDisplay(),readOnly:$(".discussion-module").data("read-only")},this.model.attributes);return edx.HtmlUtils.setHtml(this.$el,e(t)),this.delegateEvents(),this.renderAttrs(),this.$el.find(".timeago").timeago(),this.convertMath(),this.addReplyLink(),this},t.prototype.addReplyLink=function(){var e,t;if(this.model.hasOwnProperty("parent"))return t=this.model.parent.get("username")||gettext("anonymous"),e=edx.HtmlUtils.interpolateHtml(edx.HtmlUtils.HTML("<a href='#comment_{parent_id}'>@{name}</a>:  "),{parent_id:this.model.parent.id,name:t}),edx.HtmlUtils.prepend(this.$(".response-body p:first"),e)},t.prototype.convertMath=function(){DiscussionUtil.convertMath(this.$el.find(".response-body")),DiscussionUtil.typesetMathJax(this.$el.find(".response-body"))},t.prototype._delete=function(e){return this.trigger("comment:_delete",e)},t.prototype.edit=function(e){return this.trigger("comment:edit",e)},t}())}).call(window)}).call(window)},733(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.ResponseCommentView=function(){function t(){var e=this;return this.update=function(){return t.prototype.update.apply(e,arguments)},this.edit=function(){return t.prototype.edit.apply(e,arguments)},this.cancelEdit=function(){return t.prototype.cancelEdit.apply(e,arguments)},this._delete=function(){return t.prototype._delete.apply(e,arguments)},t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,DiscussionContentView),t.prototype.tagName="li",t.prototype.$=function(e){return this.$el.find(e)},t.prototype.initialize=function(e){return this.startHeader=e.startHeader,t.__super__.initialize.call(this)},t.prototype.render=function(){return this.renderShowView(),this},t.prototype.renderSubView=function(e){return e.setElement(this.$el),e.render(),e.delegateEvents()},t.prototype.renderShowView=function(){if(!this.showView)return this.editView&&(this.editView.undelegateEvents(),this.editView.$el.empty(),this.editView=null),this.showView=new ResponseCommentShowView({model:this.model}),this.showView.bind("comment:_delete",this._delete),this.showView.bind("comment:edit",this.edit),this.renderSubView(this.showView)},t.prototype.renderEditView=function(){if(!this.editView)return this.showView&&(this.showView.undelegateEvents(),this.showView.$el.empty(),this.showView=null),this.editView=new ResponseCommentEditView({model:this.model,startHeader:this.startHeader}),this.editView.bind("comment:update",this.update),this.editView.bind("comment:cancel_edit",this.cancelEdit),this.renderSubView(this.editView)},t.prototype._delete=function(e){var t,n,i=this;if(e.preventDefault(),this.model.can("can_delete")&&confirm(gettext("Are you sure you want to delete this comment?")))return n=this.model.urlFor("_delete"),t=$(e.target),DiscussionUtil.safeAjax({$elem:t,url:n,type:"POST",success:function(){return i.model.remove(),i.$el.remove()},error:function(){return DiscussionUtil.discussionAlert(gettext("Error"),gettext("This comment could not be deleted. Refresh the page and try again."))}})},t.prototype.cancelEdit=function(e){return this.trigger("comment:cancel_edit",e),this.renderShowView()},t.prototype.edit=function(e){return this.trigger("comment:edit",e),this.renderEditView()},t.prototype.update=function(e){var t,n,i=this;return t=this.editView.$(".edit-comment-body textarea").val(),n=DiscussionUtil.urlFor("update_comment",this.model.id),DiscussionUtil.safeAjax({$elem:$(e.target),$loading:$(e.target),url:n,type:"POST",dataType:"json",data:{body:t},error:DiscussionUtil.formErrorHandler(this.$(".edit-comment-form-errors")),success:function(){return i.model.set("body",t),i.cancelEdit()}})},t}())}).call(window)}).call(window)},907(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.ThreadResponseEditView=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,Backbone.View),t.prototype.events={"click .post-update":"update","click .post-cancel":"cancel_edit"},t.prototype.$=function(e){return this.$el.find(e)},t.prototype.initialize=function(e){return this.options=e,t.__super__.initialize.call(this)},t.prototype.render=function(){var e=$.extend({mode:this.options.mode,startHeader:this.options.startHeader},this.model.attributes);return this.template=edx.HtmlUtils.template($("#thread-response-edit-template").html()),edx.HtmlUtils.setHtml(this.$el,this.template(e)),this.delegateEvents(),DiscussionUtil.makeWmdEditor(this.$el,$.proxy(this.$,this),"edit-post-body"),this},t.prototype.update=function(e){return this.trigger("response:update",e)},t.prototype.cancel_edit=function(e){return this.trigger("response:cancel_edit",e)},t}())}).call(window)}).call(window)},808(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.ThreadResponseShowView=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,DiscussionContentShowView),t.prototype.initialize=function(){return t.__super__.initialize.call(this),this.listenTo(this.model,"change",this.render)},t.prototype.renderTemplate=function(){return edx.HtmlUtils.template($("#thread-response-show-template").html())(_.extend({cid:this.model.cid,author_display:this.getAuthorDisplay(),endorser_display:this.getEndorserDisplay(),readOnly:$(".discussion-module").data("read-only")},this.model.attributes))},t.prototype.render=function(){return edx.HtmlUtils.setHtml(this.$el,this.renderTemplate()),this.delegateEvents(),this.renderAttrs(),this.$el.find(".posted-details .timeago").timeago(),this.convertMath(),this},t.prototype.convertMath=function(){DiscussionUtil.convertMath(this.$(".response-body"))},t.prototype.edit=function(e){return this.trigger("response:edit",e)},t.prototype._delete=function(e){return this.trigger("response:_delete",e)},t}())}).call(window)}).call(window)},410(){(function(){(function(){"use strict";var e={}.hasOwnProperty;"undefined"!=typeof Backbone&&null!==Backbone&&(this.ThreadResponseView=function(){function t(){var e=this;return this.update=function(){return t.prototype.update.apply(e,arguments)},this.edit=function(){return t.prototype.edit.apply(e,arguments)},this.cancelEdit=function(){return t.prototype.cancelEdit.apply(e,arguments)},this._delete=function(){return t.prototype._delete.apply(e,arguments)},this.renderComment=function(){return t.prototype.renderComment.apply(e,arguments)},t.__super__.constructor.apply(this,arguments)}return function(t,n){for(var i in n)e.call(n,i)&&(t[i]=n[i]);function o(){this.constructor=t}o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype}(t,DiscussionContentView),t.prototype.tagName="li",t.prototype.className="forum-response",t.prototype.events={"click .discussion-submit-comment":"submitComment","focus .wmd-input":"showEditorChrome"},t.prototype.$=function(e){return this.$el.find(e)},t.prototype.initialize=function(e){this.startHeader=e.startHeader,this.collapseComments=e.collapseComments,this.createShowView(),this.readOnly=$(".discussion-module").data("read-only")},t.prototype.renderTemplate=function(){var e,t;return this.template=_.template($("#thread-response-template").html()),(e=$("#discussion-container")).length||(e=$(".discussion-module")),t=_.extend(this.model.toJSON(),{wmdId:void 0!==this.model.id?this.model.id:(new Date).getTime(),create_sub_comment:e.data("user-create-subcomment"),readOnly:this.readOnly}),this.template(t)},t.prototype.render=function(){return this.$el.addClass("response_"+this.model.get("id")),edx.HtmlUtils.setHtml(this.$el,edx.HtmlUtils.HTML(this.renderTemplate())),this.delegateEvents(),this.renderShowView(),this.renderAttrs(),this.model.get("thread").get("closed")&&this.hideCommentForm(),this.renderComments(),this},t.prototype.afterInsert=function(){return this.makeWmdEditor("comment-body"),this.hideEditorChrome()},t.prototype.hideEditorChrome=function(){return this.$(".wmd-button-row").hide(),this.$(".wmd-preview-container").hide(),this.$(".wmd-input").css({height:"35px",padding:"5px"}),this.$(".comment-post-control").hide()},t.prototype.showEditorChrome=function(){return this.$(".wmd-button-row").show(),this.$(".wmd-preview-container").show(),this.$(".comment-post-control").show(),this.$(".wmd-input").css({height:"125px",padding:"10px"})},t.prototype.renderComments=function(){var e,t,n=this;return t=new Comments,this.commentViews=[],t.comparator=function(e){return e.get("created_at")},e=function(n){return t.add(n),new Comments(n.get("children")).each(function(t){return t.parent=n,e(t)})},this.model.get("comments").each(e),t.each(function(e){return n.renderComment(e,!1,null)}),this.collapseComments&&t.length?(this.$(".comments").hide(),this.$(".action-show-comments").on("click",function(e){return e.preventDefault(),n.$(".action-show-comments").hide(),n.$(".comments").show()})):this.$(".action-show-comments").hide()},t.prototype.renderComment=function(e){var t,n=this;return e.set("thread",this.model.get("thread")),(t=new ResponseCommentView({model:e,startHeader:this.startHeader})).render(),this.readOnly?this.$el.find(".comments").append(t.el):this.$el.find(".comments .new-comment").before(t.el),t.bind("comment:edit",function(e){return n.editView&&n.cancelEdit(e),n.cancelCommentEdits(),n.hideCommentForm()}),t.bind("comment:cancel_edit",function(){return n.showCommentForm()}),this.commentViews.push(t),this.focusToTheCommentResponse(t.$el.closest(".forum-response")),DiscussionUtil.typesetMathJax(t.$el.find(".response-body")),t},t.prototype.submitComment=function(e){var t,n,i,o;if(e.preventDefault(),i=this.model.urlFor("reply"),(t=this.getWmdContent("comment-body")).trim().length)return this.setWmdContent("comment-body",""),n=new Comment({body:t,created_at:(new Date).toISOString(),username:window.user.get("username"),abuse_flaggers:[],user_id:window.user.get("id"),id:"unsaved"}),o=this.renderComment(n),this.hideEditorChrome(),this.trigger("comment:add",n),DiscussionUtil.safeAjax({$elem:$(e.target),url:i,type:"POST",dataType:"json",data:{body:t},success:function(e){return n.set(e.content),n.updateInfo(e.annotated_content_info),o.render()}})},t.prototype.focusToTheCommentResponse=function(e){return $(e).attr("tabindex","-1").focus()},t.prototype._delete=function(e){var t,n;if(e.preventDefault(),this.model.can("can_delete")&&confirm(gettext("Are you sure you want to delete this response?")))return n=this.model.urlFor("_delete"),this.model.remove(),this.$el.remove(),t=$(e.target),DiscussionUtil.safeAjax({$elem:t,url:n,type:"POST"})},t.prototype.createEditView=function(){if(this.showView&&this.showView.$el.empty(),!this.editView)return this.editView=new ThreadResponseEditView({model:this.model,startHeader:this.startHeader}),this.editView.bind("response:update",this.update),this.editView.bind("response:cancel_edit",this.cancelEdit);this.editView.model=this.model},t.prototype.renderSubView=function(e){return e.setElement(this.$(".discussion-response")),e.render(),e.delegateEvents()},t.prototype.renderEditView=function(){return this.renderSubView(this.editView)},t.prototype.cancelCommentEdits=function(){return _.each(this.commentViews,function(e){return e.cancelEdit()})},t.prototype.hideCommentForm=function(){return this.$(".comment-form").closest("li").hide()},t.prototype.showCommentForm=function(){return this.$(".comment-form").closest("li").show()},t.prototype.createShowView=function(){var e=this;if(this.editView&&this.editView.$el.empty(),!this.showView)return this.showView=new ThreadResponseShowView({model:this.model}),this.showView.bind("response:_delete",this._delete),this.showView.bind("response:edit",this.edit),this.showView.on("comment:endorse",function(){return e.trigger("comment:endorse")});this.showView.model=this.model},t.prototype.renderShowView=function(){return this.renderSubView(this.showView)},t.prototype.cancelEdit=function(e){return e.preventDefault(),this.createShowView(),this.renderShowView(),DiscussionUtil.typesetMathJax(this.$el.find(".response-body")),this.showCommentForm()},t.prototype.edit=function(){return this.createEditView(),this.renderEditView(),this.cancelCommentEdits(),this.hideCommentForm()},t.prototype.update=function(e){var t,n,i=this;return t=this.editView.$(".edit-post-body textarea").val(),n=DiscussionUtil.urlFor("update_comment",this.model.id),DiscussionUtil.safeAjax({$elem:$(e.target),$loading:e?$(e.target):void 0,url:n,type:"POST",dataType:"json",data:{body:t},error:DiscussionUtil.formErrorHandler(this.$(".edit-post-form-errors")),success:function(){return i.editView.$(".edit-post-body textarea").val("").attr("prev-text",""),i.editView.$(".wmd-preview p").html(""),i.model.set({body:t}),i.createShowView(),i.renderShowView(),DiscussionUtil.typesetMathJax(i.$el.find(".response-body")),i.showCommentForm()}})},t}())}).call(window)}).call(window)},88(){(function(){(function(){var e;e=function(){var e,t;function n(e,t){this.inlineMark=e||"$",this.displayMark=t||"$$",this.math=null,this.blocks=null}return t=/(\$\$?|\\(?:begin|end)\{[a-z]*\*?\}|\\[\\{}$]|[{}]|(?:\n\s*)+|@@\d+@@)/i,e=/(^|[^\\])(`+)([^\n]*?[^`\n])\2(?!`)/gm,n.prototype.processMath=function(e,t,n){var i,o,r,s,a;for(i=this.blocks.slice(e,t+1).join("").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),MathJax.Hub.Browser.isMSIE&&(i=i.replace(/(%[^\n]*)\n/g,"$1<br/>\n")),o=r=s=e+1,a=t;s<=a?r<=a:r>=a;o=s<=a?++r:--r)this.blocks[o]="";return this.blocks[e]="@@"+this.math.length+"@@",n&&(i=n(i)),this.math.push(i)},n.prototype.removeMath=function(n){var i,o,r,s,a,d,l,c,u;for(n=n||"",this.math=[],u=a=l=null,o=0,/`/.test(n)?(n=n.replace(/~/g,"~T").replace(e,function(e){return e.replace(/\$/g,"~D")}),s=function(e){return e.replace(/~([TD])/g,function(e,t){return{T:"~",D:"$"}[t]})}):s=function(e){return e},this.blocks=_split(n.replace(/\r\n?/g,"\n"),t),r=d=1,c=this.blocks.length;d<c;r=d+=2)"@"===(i=this.blocks[r]).charAt(0)?(this.blocks[r]="@@"+this.math.length+"@@",this.math.push(i)):u?i===a?o?l=r:(this.processMath(u,r,s),u=a=l=null):i.match(/\n.*\n/)?(l&&(r=l,this.processMath(u,r,s)),u=a=l=null,o=0):"{"===i?++o:"}"===i&&o&&--o:i===this.inlineMark||i===this.displayMark?(u=r,a=i,o=0):"begin"===i.substr(1,5)&&(u=r,a="\\end"+i.substr(6),o=0);return l&&(this.processMath(u,l,s),u=a=l=null),s(this.blocks.join(""))},n.removeMathWrapper=function(e){return function(t){return e.removeMath(t)}},n.prototype.replaceMath=function(e){var t;return e=e.replace(/@@(\d+)@@/g,(t=this,function(e,n){return t.math[n]})),this.math=null,e},n.replaceMathWrapper=function(e){return function(t){return e.replaceMath(t)}},n}(),"undefined"!=typeof Markdown&&null!==Markdown&&(Markdown.getMathCompatibleConverter=function(t){var n,i;return t||(t=function(e){return e}),n=Markdown.getSanitizingConverter(),"undefined"!=typeof MathJax&&null!==MathJax&&(i=new e,n.hooks.chain("preConversion",e.removeMathWrapper(i)),n.hooks.chain("postConversion",function(n){return t(e.replaceMathWrapper(i)(n))})),n},Markdown.makeWmdEditor=function(e,t,n,i){var o,r,s,a,d,l,c,u,p,h,m;if((o=$(e)).length)return o.find(".wmd-panel").length||(h=o.html(),o.empty(),m="wmd-input"+(a=t||""),s=$("<div>").addClass("wmd-preview-container").attr("role","region").attr("aria-label",gettext("HTML preview of post")).append($("<div>").addClass("wmd-preview-label").text(gettext("Preview"))).append($("<div>").attr("id","wmd-preview"+a).addClass("wmd-panel wmd-preview")),r=$("<div>").addClass("wmd-panel").append($("<div>").addClass("wmd-button-bar"+a)).append($("<label>").addClass("sr").attr("for",m).text(gettext("Your question or idea (required)"))).append($("<textarea>").addClass("wmd-input").attr("id",m).html(h)).append(s),o.append(r)),l=Markdown.getMathCompatibleConverter(i),d=function(e,t,n){return $("#loading").ajaxStart(function(){return $(this).show()}).ajaxComplete(function(){return $(this).hide()}),$("#upload").ajaxStart(function(){return $(this).hide()}).ajaxComplete(function(){return $(this).show()}),$.ajaxFileUpload({url:e,secureuri:!1,fileElementId:"file-upload",dataType:"json",success:function(e,i){var o,r;return r=e.result.file_url,""!==(o=e.result.error)?(alert(o),n&&$("#file-upload").unbind("change").change(n),console.log(o)):$(t).attr("value",r)},error:function(e,t,i){if(alert(i),n)return $("#file-upload").unbind("change").change(n)}})},p=function(e,t){return d(n,t,p)},u=new Markdown.Editor(l,t,null,p),c=new MathJaxDelayRenderer,u.hooks.chain("onPreviewPush",function(e,t){return c.render({text:e,previewSetter:t})}),u.run(),u;console.log("warning: elem for makeWmdEditor doesn't exist")})}).call(this)}).call(window)},817(){(function(){(function(){$(function(){if("Microsoft Internet Explorer"===window.navigator.appName)return"undefined"==typeof MathJax||null===MathJax||function(){try{return new ActiveXObject("MathPlayer.Factory.1"),!0}catch(e){return!1}}()||$("#mathjax-accessibility-message").attr("aria-hidden","false"),"undefined"!=typeof MathJax&&null!==MathJax&&$("#mathplayer-browser-message").length>0?$("#mathplayer-browser-message").attr("aria-hidden","false"):$("#mathjax-accessibility-message").attr("aria-hidden","true")})}).call(this)}).call(window)},588(){(function(){(function(){var e;e=function(){return(new Date).getTime()},this.MathJaxDelayRenderer=function(){var t,n;function i(e){e=e||{},this.maxDelay=e.maxDelay||this.maxDelay,this.bufferId=e.bufferId||t+n,n+=1,this.$buffer=$("<div>").attr("id",this.bufferId).css("display","none").appendTo($("body"))}return i.prototype.maxDelay=3e3,i.prototype.mathjaxRunning=!1,i.prototype.elapsedTime=0,i.prototype.mathjaxDelay=0,i.prototype.mathjaxTimeout=void 0,t="mathjax_delay_buffer",n=0,i.prototype.render=function(t){var n,i,o,r,s,a,d;return i=t.element,r=t.previewSetter,null==(a=t.text)&&(a=$(i).html()),o=t.preprocessor,!1===t.delay?(null!=o&&(a=o(a)),$(i).html(a),MathJax.Hub.Queue(["Typeset",MathJax.Hub,$(i).attr("id")])):(this.mathjaxTimeout&&(window.clearTimeout(this.mathjaxTimeout),this.mathjaxTimeout=void 0),n=Math.min(this.elapsedTime+this.mathjaxDelay,this.maxDelay),d=this,s=function(){var t,n;if(!d.mathjaxRunning)return n=e(),null!=o&&(a=o(a)),d.$buffer.html(a),t=e(),d.elapsedTime=t-n,"undefined"!=typeof MathJax&&null!==MathJax?(n=e(),d.mathjaxRunning=!0,MathJax.Hub.Queue(["Typeset",MathJax.Hub,d.$buffer.attr("id")],function(){return d.mathjaxRunning=!1,t=e(),d.mathjaxDelay=t-n,r?r($(d.$buffer).html()):$(i).html($(d.$buffer).html())})):d.mathjaxDelay=0},this.mathjaxTimeout=window.setTimeout(s,n))},i}()}).call(this)}).call(window)},204(){(function(){!function(){var e={},t={},n={},i=window.document,o=window.RegExp,r=window.navigator,s=/msie/.test(r.userAgent.toLowerCase()),a=/msie 6/.test(r.userAgent.toLowerCase())||/msie 5/.test(r.userAgent.toLowerCase()),d=/opera/.test(r.userAgent.toLowerCase()),l=gettext("Insert Hyperlink"),c=gettext("e.g. 'http://google.com'"),u=gettext("Link Description"),p=gettext("e.g. 'google'"),h=gettext("Please provide a description of the link destination."),m=gettext("Insert Image (upload file or type URL)"),f=gettext("Type in a URL or use the \"Choose File\" button to upload a file from your machine. (e.g. 'http://example.com/img/clouds.jpg')"),g=gettext("Image Description"),y=gettext("Please describe this image or agree that it has no contextual value by checking the checkbox."),w=gettext("e.g. 'Sky with clouds'. The description is helpful for users who cannot see the image."),v={href:"http://www.w3.org/TR/html5/embedded-content-0.html#alt",text:gettext("How to create useful text alternatives.")},b=gettext("This image is for decorative purposes only and does not require a description."),x=gettext("Markdown Editing Help"),T=gettext("URL"),C=gettext("Please provide a valid URL.");function k(){}function D(e){this.buttonBar=function(e){for(var t=i.getElementsByClassName(e),n=0;n<t.length;++n){var o=t[n];if(0==o.children.length)return o}return null}("wmd-button-bar"+e),this.preview=i.getElementById("wmd-preview"+e),this.input=i.getElementById("wmd-input"+e)}function H(t,n){var i,o,r,a=this,d=[],l=0,c="none",u=function(e,t){c!=e&&(c=e,t||h()),s&&"moving"==c?r=null:o=setTimeout(p,1)},p=function(e){r=new S(n,e),o=void 0};this.setCommandMode=function(){c="command",h(),o=setTimeout(p,0)},this.canUndo=function(){return l>1},this.canRedo=function(){return!!d[l+1]},this.undo=function(){a.canUndo()&&(i?(i.restore(),i=null):(d[l]=new S(n),d[--l].restore(),t&&t())),c="none",n.input.focus(),p()},this.redo=function(){a.canRedo()&&(d[++l].restore(),t&&t()),c="none",n.input.focus(),p()};var h=function(){var e=r||new S(n);if(!e)return!1;"moving"!=c?(i&&(d[l-1].text!=i.text&&(d[l++]=i),i=null),d[l++]=e,d[l+1]=null,t&&t()):i||(i=e)},m=function(e){var t=!1;if(e.ctrlKey||e.metaKey){var n=e.charCode||e.keyCode;switch(String.fromCharCode(n)){case"y":a.redo(),t=!0;break;case"z":e.shiftKey?a.redo():a.undo(),t=!0}}t&&(e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1))},f=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;t>=33&&t<=40||t>=63232&&t<=63235?u("moving"):8==t||46==t||127==t?u("deleting"):13==t?u("newlines"):27==t?u("escape"):(t<16||t>20)&&91!=t&&u("typing")}};!function(){e.addEvent(n.input,"keypress",function(e){!e.ctrlKey&&!e.metaKey||89!=e.keyCode&&90!=e.keyCode||e.preventDefault()});var t=function(){(s||r&&r.text!=n.input.value)&&null==o&&(c="paste",h(),p())};e.addEvent(n.input,"keydown",m),e.addEvent(n.input,"keydown",f),e.addEvent(n.input,"mousedown",function(){u("moving")}),n.input.onpaste=t,n.input.ondrop=t}(),p(!0),h()}function S(t,n){var o=this,r=t.input;this.init=function(){e.isVisible(r)&&(!n&&i.activeElement&&i.activeElement!==r||(this.setInputAreaSelectionStartEnd(),this.scrollTop=r.scrollTop,(!this.text&&r.selectionStart||0===r.selectionStart)&&(this.text=r.value)))},this.setInputAreaSelection=function(){if(e.isVisible(r))if(void 0===r.selectionStart||d){if(i.selection){if(i.activeElement&&i.activeElement!==r)return;r.focus();var t=r.createTextRange();t.moveStart("character",-r.value.length),t.moveEnd("character",-r.value.length),t.moveEnd("character",o.end),t.moveStart("character",o.start),t.select()}}else r.focus(),r.selectionStart=o.start,r.selectionEnd=o.end,r.scrollTop=o.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(t.ieCachedRange||!r.selectionStart&&0!==r.selectionStart){if(i.selection){o.text=e.fixEolChars(r.value);var n=t.ieCachedRange||i.selection.createRange(),s=e.fixEolChars(n.text),a="",d=a+s+a;n.text=d;var l=e.fixEolChars(r.value);n.moveStart("character",-d.length),n.text=s,o.start=l.indexOf(a),o.end=l.lastIndexOf(a)-1;var c=o.text.length-e.fixEolChars(r.value).length;if(c){for(n.moveStart("character",-s.length);c--;)s+="\n",o.end+=1;n.text=s}t.ieCachedRange&&(o.scrollTop=t.ieCachedScrollTop),t.ieCachedRange=null,this.setInputAreaSelection()}}else o.start=r.selectionStart,o.end=r.selectionEnd},this.restore=function(){null!=o.text&&o.text!=r.value&&(r.value=o.text),this.setInputAreaSelection(),r.scrollTop=o.scrollTop},this.getChunks=function(){var t=new k;return t.before=e.fixEolChars(o.text.substring(0,o.start)),t.startTag="",t.selection=e.fixEolChars(o.text.substring(o.start,o.end)),t.endTag="",t.after=e.fixEolChars(o.text.substring(o.end)),t.scrollTop=o.scrollTop,t},this.setChunks=function(e){e.before+=e.startTag,e.after=e.endTag+e.after,this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},this.init()}function U(n,o,r){var a,d,l,c=function(){var e=0;return window.innerHeight?e=window.pageYOffset:i.documentElement&&i.documentElement.scrollTop?e=i.documentElement.scrollTop:i.body&&(e=i.body.scrollTop),e},u=function(){if(o.preview){var e=o.input.value;if(!e||e!=l){l=e;var t=(new Date).getTime();e=n.makeHtml(e);var i=(new Date).getTime();d=i-t,v(e)}}},p=function(){a&&(clearTimeout(a),a=void 0);var e=0;(e=d)>3e3&&(e=3e3),a=setTimeout(u,e)};this.refresh=function(e){e?(l="",u()):p()},this.processingTime=function(){return d};var h,m,f,g=!0,y=function(e){var t=o.preview,n=t.parentNode,i=t.nextSibling;n.removeChild(t),t.innerHTML=e,i?n.insertBefore(t,i):n.appendChild(t)},_=function(e){o.preview.innerHTML=e},w=function(e){if(h)return h(e);try{_(e),h=_}catch(t){(h=y)(e)}},v=function(e){var n,i=t.getTop(o.input)-c();if(o.preview&&r(e,w),o.preview&&(o.preview.scrollTop=(o.preview.scrollHeight-o.preview.clientHeight)*((n=o.preview).scrollHeight<=n.clientHeight?1:n.scrollTop/(n.scrollHeight-n.clientHeight))),g)g=!1;else{var a=t.getTop(o.input)-c();s?setTimeout(function(){window.scrollBy(0,a-i)},0):window.scrollBy(0,a-i)}};m=o.input,f=p,e.addEvent(m,"input",f),m.onpaste=f,m.ondrop=f,e.addEvent(m,"keypress",f),e.addEvent(m,"keydown",f),u(),o.preview&&(o.preview.scrollTop=0)}function E(t,n,o,a,l,c,u){var p=n.input,h={};!function(){var e=n.buttonBar,i=document.createElement("div");i.setAttribute("role","toolbar"),i.id="wmd-button-row"+t,i.className="wmd-button-row",i=e.appendChild(i);var o=0,s=function(e,n,r,s,a){var d=document.createElement("button");d.tabIndex=a,d.className="wmd-button",d.style.left=o+"px",o+=25;var l=document.createElement("span");return d.id=e+t,d.appendChild(l),d.title=n,d.XShift=r,s&&(d.textOp=s),g(d,!0),i.appendChild(d),d},a=function(e){var n=document.createElement("span");n.setAttribute("role","separator"),n.className="wmd-spacer wmd-spacer"+e,n.id="wmd-spacer"+e+t,i.appendChild(n),o+=25};h.bold=s("wmd-bold-button",gettext("Bold (Ctrl+B)"),"0px",y("doBold"),0),h.italic=s("wmd-italic-button",gettext("Italic (Ctrl+I)"),"-20px",y("doItalic"),-1),a(1),h.link=s("wmd-link-button",gettext("Hyperlink (Ctrl+L)"),"-40px",y(function(e,t){return this.doLinkOrImage(e,t,!1)}),-1),h.quote=s("wmd-quote-button",gettext("Blockquote (Ctrl+Q)"),"-60px",y("doBlockquote"),-1),h.code=s("wmd-code-button",gettext("Code Sample (Ctrl+K)"),"-80px",y("doCode"),-1),h.image=s("wmd-image-button",gettext("Image (Ctrl+G)"),"-100px",y(function(e,t){return this.doLinkOrImage(e,t,!0,u)}),-1),a(2),h.olist=s("wmd-olist-button",gettext("Numbered List (Ctrl+O)"),"-120px",y(function(e,t){this.doList(e,t,!0)}),-1),h.ulist=s("wmd-ulist-button",gettext("Bulleted List (Ctrl+U)"),"-140px",y(function(e,t){this.doList(e,t,!1)}),-1),h.heading=s("wmd-heading-button",gettext("Heading (Ctrl+H)"),"-160px",y("doHeading"),-1),h.hr=s("wmd-hr-button",gettext("Horizontal Rule (Ctrl+R)"),"-180px",y("doHorizontalRule"),-1),a(3),h.undo=s("wmd-undo-button",gettext("Undo (Ctrl+Z)"),"-200px",null,-1),h.undo.execute=function(e){e&&e.undo()};var d=/win/.test(r.platform.toLowerCase())?gettext("Redo (Ctrl+Y)"):gettext("Redo (Ctrl+Shift+Z)");if(h.redo=s("wmd-redo-button",d,"-220px",null,-1),h.redo.execute=function(e){e&&e.redo()},c){var l=document.createElement("span"),p=document.createElement("span");l.appendChild(p),l.className="wmd-button wmd-help-button",l.id="wmd-help-button"+t,l.XShift="-240px",l.isHelp=!0,l.style.right="0px",l.title=c.title||x,l.onclick=c.handler,g(l,!0),i.appendChild(l),h.help=l}_()}();var m="keydown";function f(e){if(p.focus(),e.textOp){o&&o.setCommandMode();var t=new S(n);if(!t)return;var i=t.getChunks(),r=function(){p.focus(),i&&t.setChunks(i),t.restore(),a.refresh()};e.textOp(i,r)||r()}e.execute&&e.execute(o)}function g(t,o){var r=t.getElementsByTagName("span")[0];o?(r.style.backgroundPosition=t.XShift+" 0px",t.onmouseover=function(){r.style.backgroundPosition=this.XShift+" -40px"},t.onmouseout=function(){r.style.backgroundPosition=this.XShift+" 0px"},s&&(t.onmousedown=function(){i.activeElement&&i.activeElement!==n.input||(n.ieCachedRange=document.selection.createRange(),n.ieCachedScrollTop=n.input.scrollTop)}),t.isHelp||(t.onclick=function(){return this.onmouseout&&this.onmouseout(),f(this),!1},e.addEvent(t,"keydown",function(e){var n=e.charCode||e.keyCode;32!=n&&13!=n||(e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1),f(t))})),t.removeAttribute("aria-disabled")):(r.style.backgroundPosition=t.XShift+" -20px",t.onmouseover=t.onmouseout=t.onclick=function(){},t.setAttribute("aria-disabled",!0))}function y(e){return"string"==typeof e&&(e=l[e]),function(){e.apply(l,arguments)}}function _(){o&&(g(h.undo,o.canUndo()),g(h.redo,o.canRedo()))}d&&(m="keypress"),e.addEvent(p,m,function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey){var t=e.charCode||e.keyCode;switch(String.fromCharCode(t).toLowerCase()){case"b":f(h.bold);break;case"i":f(h.italic);break;case"l":f(h.link);break;case"q":f(h.quote);break;case"k":f(h.code);break;case"g":f(h.image);break;case"o":f(h.olist);break;case"u":f(h.ulist);break;case"h":f(h.heading);break;case"r":f(h.hr);break;case"y":f(h.redo);break;case"z":e.shiftKey?f(h.redo):f(h.undo);break;default:return}e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1)}}),e.addEvent(p,"keyup",function(e){if(e.shiftKey&&!e.ctrlKey&&!e.metaKey&&13===(e.charCode||e.keyCode)){var t={};t.textOp=y("doAutoindent"),f(t)}}),s&&e.addEvent(p,"keydown",function(e){if(27===e.keyCode)return!1}),this.setUndoRedoButtonStates=_}function A(e){this.hooks=e}Markdown.Editor=function(t,n,o,r){n=n||"";var s=this.hooks=new Markdown.HookCollection;s.addNoop("onPreviewPush"),s.addNoop("postBlockquoteCreation"),s.addFalse("insertImageDialog"),this.util=e,this.getConverter=function(){return t};var a,d=this;this.run=function(){if(!a){a=new D(n);var e,l,c=new A(s),u=new U(t,a,function(e,t){s.onPreviewPush(e,t)});/\?noundo/.test(i.location.href)||(e=new H(function(){u.refresh(),l&&l.setUndoRedoButtonStates()},a),this.textOperation=function(t){e.setCommandMode(),t(),d.refreshPreview()}),(l=new E(n,a,e,u,c,o,r)).setUndoRedoButtonStates(),(d.refreshPreview=function(){u.refresh(!0)})()}}},k.prototype.findTags=function(t,n){var i,o=this;t&&(i=e.extendRegExp(t,"","$"),this.before=this.before.replace(i,function(e){return o.startTag+=e,""}),i=e.extendRegExp(t,"^",""),this.selection=this.selection.replace(i,function(e){return o.startTag+=e,""})),n&&(i=e.extendRegExp(n,"","$"),this.selection=this.selection.replace(i,function(e){return o.endTag=e+o.endTag,""}),i=e.extendRegExp(n,"^",""),this.after=this.after.replace(i,function(e){return o.endTag=e+o.endTag,""}))},k.prototype.trimWhitespace=function(e){var t,n,i=this;e?t=n="":(t=function(e){return i.before+=e,""},n=function(e){return i.after=e+i.after,""}),this.selection=this.selection.replace(/^(\s*)/,t).replace(/(\s*)$/,n)},k.prototype.skipLines=function(e,t,n){var i,r;if(void 0===e&&(e=1),void 0===t&&(t=1),e++,t++,navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag+=o.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag+=o.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before+=o.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after+=o.$1,this.before){for(i=r="";e--;)i+="\\n?",r+="\n";n&&(i="\\n*"),this.before=this.before.replace(new o(i+"$",""),r)}if(this.after){for(i=r="";t--;)i+="\\n?",r+="\n";n&&(i="\\n*"),this.after=this.after.replace(new o(i,""),r)}},e.isValidUrl=function(e){return/^((?:http|https|ftp):\/{2}|\/)[^]+$/.test(e)},e.isVisible=function(e){return window.getComputedStyle?"none"!==window.getComputedStyle(e,null).getPropertyValue("display"):e.currentStyle?"none"!==e.currentStyle.display:void 0},e.addEvent=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},e.removeEvent=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},e.fixEolChars=function(e){return(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")},e.extendRegExp=function(e,t,n){null==t&&(t=""),null==n&&(n="");var i,r=e.toString();return r=(r=r.replace(/\/([gim]*)$/,function(e,t){return i=t,""})).replace(/(^\/|\/$)/g,""),new o(r=t+r+n,i)},t.getTop=function(e,t){var n=e.offsetTop;if(!t)for(;e=e.offsetParent;)n+=e.offsetTop;return n},t.getHeight=function(e){return e.offsetHeight||e.scrollHeight},t.getWidth=function(e){return e.offsetWidth||e.scrollWidth},t.getPageSize=function(){var e,t,n,o;return self.innerHeight&&self.scrollMaxY?(e=i.body.scrollWidth,t=self.innerHeight+self.scrollMaxY):i.body.scrollHeight>i.body.offsetHeight?(e=i.body.scrollWidth,t=i.body.scrollHeight):(e=i.body.offsetWidth,t=i.body.offsetHeight),self.innerHeight?(n=self.innerWidth,o=self.innerHeight):i.documentElement&&i.documentElement.clientHeight?(n=i.documentElement.clientWidth,o=i.documentElement.clientHeight):i.body&&(n=i.body.clientWidth,o=i.body.clientHeight),[Math.max(e,n),Math.max(t,o),n,o]},n.createBackground=function(){var e=i.createElement("div"),n=e.style;e.className="wmd-prompt-background",n.position="absolute",n.top="0",n.zIndex="1000",s?n.filter="alpha(opacity=50)":n.opacity="0.5";var o=t.getPageSize();return n.height=o[1]+"px",s?(n.left=i.documentElement.scrollLeft,n.width=i.documentElement.clientWidth):(n.left="0",n.width="100%"),i.body.appendChild(e),e},n.prompt=function(n,o,r,s,d,l,c,u,p,h,m,f){var g,y,w,v,b,x,T,C=function(e){27===(e.charCode||e.keyCode)&&k(!0)},k=function(t){e.removeEvent(i.body,"keydown",C);var n=y.value.trim(),o=v.value.trim();y.classList.remove("has-error"),w.style.display="none",v.classList.remove("has-error"),b.style.display="none",t?n=null:(n=n.replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(n)||"/"===n.charAt(0)||(n="http://"+n));var r=e.isValidUrl(n),s=v.checkValidity()&&(!v.required||o.length);if(r&&s||t)g.parentNode.removeChild(g),h(n,o);else{var a=0;r||(y.classList.add("has-error"),w.style.display="inline-block",a+=1),s||(v.classList.add("has-error"),b.style.display="inline-block",a+=1),document.getElementById("wmd-editor-dialog-form-errors").textContent=[interpolate(ngettext("%(errorCount)s error found in form.","%(errorCount)s errors found in form.",a),{errorCount:a},!0),r?"":w.textContent,s?"":b.textContent].join(" "),document.getElementById("wmd-editor-dialog-form-errors").focus()}return!1};setTimeout(function(){!function(){if((g=i.createElement("div")).innerHTML=_.template(document.getElementById("customwmd-prompt-template").innerHTML)({title:n,uploadFieldClass:f?"file-upload":"",urlLabel:o,urlError:s,urlHelp:r,urlDescLabel:d,descError:u,urlDescHelp:l,urlDescHelpLink:c,okText:gettext("OK"),cancelText:gettext("Cancel"),chooseFileText:gettext("Choose File"),imageIsDecorativeLabel:m,imageUploadHandler:f}),g.setAttribute("dir",i.head.getAttribute("dir")),g.setAttribute("role","dialog"),g.setAttribute("tabindex","-1"),g.setAttribute("aria-labelledby","editorDialogTitle"),g.className="wmd-prompt-dialog",g.style.padding="10px;",g.style.position="fixed",g.style.width="500px",g.style.zIndex="1001",i.body.appendChild(g),e.addEvent(i.body,"keydown",C),g.style.top="50%",g.style.left="50%",g.style.display="block",a&&(g.style.position="absolute",g.style.top=i.documentElement.scrollTop+200+"px",g.style.left="50%"),g.style.marginTop=-t.getHeight(g)/2+"px",g.style.marginLeft=-t.getWidth(g)/2+"px",y=document.getElementById("new-url-input"),w=document.getElementById("new-url-input-field-message"),v=document.getElementById("new-url-desc-input"),b=document.getElementById("new-url-desc-input-field-message"),y.value=p,x=document.getElementById("new-link-image-ok"),T=document.getElementById("new-link-image-cancel"),x.onclick=function(){return k(!1)},T.onclick=function(){return k(!0)},f){var h=function(){document.getElementById("file-upload").onchange=function(){f(this,y),y.focus(),h()}};h(),document.getElementById("file-upload-proxy").onclick=function(){return document.getElementById("file-upload").click(),!1},document.getElementById("img-is-decorative").onchange=function(){v.required=!v.required}}$(g).on("keydown",function(e){9===e.which&&e.shiftKey&&e.target===y?(e.preventDefault(),T.focus()):9!==e.which||e.shiftKey||e.target!==T||(e.preventDefault(),y.focus())})}();var h=p.length;if(void 0!==y.selectionStart)y.selectionStart=0,y.selectionEnd=h;else if(y.createTextRange){var D=y.createTextRange();D.collapse(!1),D.moveStart("character",-h),D.moveEnd("character",h),D.select()}g.focus()},0)};var M=A.prototype;M.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",M.unwrap=function(e){var t=new o("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")},M.wrap=function(e,t){this.unwrap(e);var n=new o("(.{1,"+t+"})( +|$\\n?)","gm"),i=this;e.selection=e.selection.replace(n,function(e,t){return new o("^"+i.prefixes,"").test(e)?e:t+"\n"}),e.selection=e.selection.replace(/\s+$/,"")},M.doBold=function(e,t){return this.doBorI(e,t,2,gettext("strong text"))},M.doItalic=function(e,t){return this.doBorI(e,t,1,gettext("emphasized text"))},M.doBorI=function(e,t,n,i){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n");var r=/(\**$)/.exec(e.before)[0],s=/(^\**)/.exec(e.after)[0],a=Math.min(r.length,s.length);if(a>=n&&(2!=a||1!=n))e.before=e.before.replace(o("[*]{"+n+"}$",""),""),e.after=e.after.replace(o("^[*]{"+n+"}",""),"");else if(!e.selection&&s){e.after=e.after.replace(/^([*_]*)/,""),e.before=e.before.replace(/(\s?)$/,"");var d=o.$1;e.before=e.before+s+d}else{e.selection||s||(e.selection=i);var l=n<=1?"*":"**";e.before+=l,e.after=l+e.after}},M.stripLinkDefs=function(e,t){return e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(e,n,i,o,r){return t[n]=e.replace(/\s*$/,""),o?(t[n]=e.replace(/["(](.+?)[")]$/,""),o+r):""})},M.addLinkDef=function(e,t){var n=0,i={};e.before=this.stripLinkDefs(e.before,i),e.selection=this.stripLinkDefs(e.selection,i),e.after=this.stripLinkDefs(e.after,i);var o="",r=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,s=function(e){n++,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+n+"]:"),o+="\n"+e},a=function(e,t,o,d,l,c){return o=o.replace(r,a),i[l]?(s(i[l]),t+o+d+n+c):e};e.before=e.before.replace(r,a),t?s(t):e.selection=e.selection.replace(r,a);var d=n;return e.after=e.after.replace(r,a),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after+="\n\n"+o,d},M.doLinkOrImage=function(e,t,i,o){var r;if(e.trimWhitespace(),e.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),!(e.endTag.length>1&&e.startTag.length>0)){if(e.selection=e.startTag+e.selection+e.endTag,e.startTag=e.endTag="",/\n\n/.test(e.selection))return void this.addLinkDef(e,null);var s=this,a=function(n,o){if(r.parentNode.removeChild(r),null!==n){e.selection=(" "+e.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var a=" [999]: "+n.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(e,t,n){return t=t.replace(/\?.*$/,function(e){return e.replace(/\+/g," ")}),t=decodeURIComponent(t),t=(t=encodeURI(t).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")).replace(/\?.*$/,function(e){return e.replace(/\+/g,"%2b")}),n&&(n=n.trim?n.trim():n.replace(/^\s*/,"").replace(/\s*$/,""),n=$.trim(n).replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),n?t+' "'+n+'"':t}),d=s.addLinkDef(e,a);e.startTag=i?"![":"[",e.endTag="]["+d+"]",e.selection||(e.selection=i?o||"":o||gettext("enter link description here"))}t()};return r=n.createBackground(),i?this.hooks.insertImageDialog(a)||n.prompt(m,T,f,C,g,w,v,y,"http://",a,b,o):n.prompt(l,T,c,C,u,p,"",h,"http://",a),!0}e.startTag=e.startTag.replace(/!?\[/,""),e.endTag="",this.addLinkDef(e,null)},M.doAutoindent=function(e,t){var n=this,i=!1;e.before=e.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),e.selection||/^[ \t]*(?:\n|$)/.test(e.after)||(e.after=e.after.replace(/^[^\n]*/,function(t){return e.selection=t,""}),i=!0),/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(e.before)&&n.doList&&n.doList(e),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(e.before)&&n.doBlockquote&&n.doBlockquote(e),/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&n.doCode&&n.doCode(e),i&&(e.after=e.selection+e.after,e.selection="")},M.doBlockquote=function(e,t){e.selection=e.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(t,n,i,o){return e.before+=n,e.after=o+e.after,i}),e.before=e.before.replace(/(>[ \t]*)$/,function(t,n){return e.selection=n+e.selection,""}),e.selection=e.selection.replace(/^(\s|>)+$/,""),e.selection=e.selection||gettext("Blockquote");var n,i="",o="";if(e.before){for(var r=e.before.replace(/\n$/,"").split("\n"),s=!1,a=0;a<r.length;a++){var d=!1;n=r[a],s=s&&n.length>0,/^>/.test(n)?(d=!0,!s&&n.length>1&&(s=!0)):d=!!/^[ \t]*$/.test(n)||s,d?i+=n+"\n":(o+=i+n,i="\n")}/(^|\n)>/.test(i)||(o+=i,i="")}e.startTag=i,e.before=o,e.after&&(e.after=e.after.replace(/^\n?/,"\n")),e.after=e.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(t){return e.endTag=t,""});var l=function(t){var n=t?"> ":"";e.startTag&&(e.startTag=e.startTag.replace(/\n((>|\s)*)\n$/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})),e.endTag&&(e.endTag=e.endTag.replace(/^\n((>|\s)*)\n/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"}))};/^(?![ ]{0,3}>)/m.test(e.selection)?(this.wrap(e,70),e.selection=e.selection.replace(/^/gm,"> "),l(!0),e.skipLines()):(e.selection=e.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(e),l(!1),!/^(\n|^)[ ]{0,3}>/.test(e.selection)&&e.startTag&&(e.startTag=e.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(e.selection)&&e.endTag&&(e.endTag=e.endTag.replace(/^\n{0,2}/,"\n\n"))),e.selection=this.hooks.postBlockquoteCreation(e.selection),/\n/.test(e.selection)||(e.selection=e.selection.replace(/^(> *)/,function(t,n){return e.startTag+=n,""}))},M.doCode=function(e,t){var n=/\S[ ]*$/.test(e.before);if(!/^[ ]*\S/.test(e.after)&&!n||/\n/.test(e.selection)){e.before=e.before.replace(/[ ]{4}$/,function(t){return e.selection=t+e.selection,""});var i=1,o=1;/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&(i=0),/^\n(\t|[ ]{4,})/.test(e.after)&&(o=0),e.skipLines(i,o),e.selection?/^[ ]{0,3}\S/m.test(e.selection)?/\n/.test(e.selection)?e.selection=e.selection.replace(/^/gm,"    "):e.before+="    ":e.selection=e.selection.replace(/^[ ]{4}/gm,""):(e.startTag="    ",e.selection=gettext("enter code here"))}else e.trimWhitespace(),e.findTags(/`/,/`/),e.startTag||e.endTag?e.endTag&&!e.startTag?(e.before+=e.endTag,e.endTag=""):e.startTag=e.endTag="":(e.startTag=e.endTag="`",e.selection||(e.selection=gettext("enter code here")))},M.doList=function(e,t,n){var i=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,r="-",s=1,a=function(){var e;return n?(e=" "+s+". ",s++):e=" "+r+" ",e},d=function(e){return void 0===n&&(n=/^\s*\d/.test(e)),e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(e){return a()})};if(e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!e.before||/\n$/.test(e.before)||/^\n/.test(e.startTag)||(e.before+=e.startTag,e.startTag=""),e.startTag){var l=/\d+[.]/.test(e.startTag);if(e.startTag="",e.selection=e.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(e),e.skipLines(),l&&(e.after=e.after.replace(i,d)),n==l)return}var c=1;e.before=e.before.replace(/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,function(e){return/^\s*([*+-])/.test(e)&&(r=o.$1),c=/[^\n]\n\n[^\n]/.test(e)?1:0,d(e)}),e.selection||(e.selection=gettext("List item"));var u=a(),p=1;e.after=e.after.replace(i,function(e){return p=/[^\n]\n\n[^\n]/.test(e)?1:0,d(e)}),e.trimWhitespace(!0),e.skipLines(c,p,!0),e.startTag=u;var h=u.replace(/./g," ");this.wrap(e,72-h.length),e.selection=e.selection.replace(/\n/g,"\n"+h)},M.doHeading=function(e,t){if(e.selection=e.selection.replace(/\s+/g," "),e.selection=e.selection.replace(/(^\s+|\s+$)/g,""),!e.selection)return e.startTag="## ",e.selection=gettext("Heading"),void(e.endTag=" ##");var n=0;e.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(e.startTag)&&(n=o.lastMatch.length),e.startTag=e.endTag="",e.findTags(null,/\s?(-+|=+)/),/=+/.test(e.endTag)&&(n=1),/-+/.test(e.endTag)&&(n=2),e.startTag=e.endTag="",e.skipLines(1,1);var i=0==n?2:n-1;if(i>0){var r=i>=2?"-":"=",s=e.selection.length;for(s>72&&(s=72),e.endTag="\n";s--;)e.endTag+=r}},M.doHorizontalRule=function(e,t){e.startTag="----------\n",e.selection="",e.skipLines(2,1,!0)}}()}).call(window)},237(){(function(){jQuery.extend({handleError:function(e,t,n,i){e.error&&e.error.call(e.context||e,t,n,i),e.global&&(e.context?jQuery(e.context):jQuery.event).trigger("ajaxError",[t,e,i])},createUploadIframe:function(e,t){var n="jUploadFrame"+e;if(window.ActiveXObject){var i=document.createElement('<iframe id="'+n+'" name="'+n+'" />');"boolean"==typeof t?i.src="javascript:false":"string"==typeof t&&(i.src=t)}else(i=document.createElement("iframe")).id=n,i.name=n;return i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",document.body.appendChild(i),i},createUploadForm:function(e,t){var n="jUploadForm"+e,i="jUploadFile"+e,o=$('<form  action="" method="POST" name="'+n+'" id="'+n+'" enctype="multipart/form-data"></form>'),r=$("#"+t),s=$(r).clone();return $(r).attr("id",i),$(r).before(s),$(r).appendTo(o),$(o).css("position","absolute"),$(o).css("top","-1200px"),$(o).css("left","-1200px"),$(o).appendTo("body"),o},ajaxFileUpload:function(e){e=jQuery.extend({},jQuery.ajaxSettings,e);var t=(new Date).getTime(),n=jQuery.createUploadForm(t,e.fileElementId),i=(jQuery.createUploadIframe(t,e.secureuri),"jUploadFrame"+t),o="jUploadForm"+t;e.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var r=!1,s={};e.global&&jQuery.event.trigger("ajaxSend",[s,e]);var a=function(t){var o=document.getElementById(i);try{o.contentWindow?(s.responseText=o.contentWindow.document.body?o.contentWindow.document.body.textContent||o.contentWindow.document.body.innerText:null,s.responseXML=o.contentWindow.document.XMLDocument?o.contentWindow.document.XMLDocument:o.contentWindow.document):o.contentDocument&&(s.responseText=o.contentDocument.document.body?o.contentDocument.document.body.textContent||document.body.innerText:null,s.responseXML=o.contentDocument.document.XMLDocument?o.contentDocument.document.XMLDocument:o.contentDocument.document)}catch(t){jQuery.handleError(e,s,null,t)}if(s||"timeout"==t){var a;r=!0;try{if("error"!=(a="timeout"!=t?"success":"error")){var d=jQuery.uploadHttpData(s,e.dataType);e.success&&e.success(d,a),e.global&&jQuery.event.trigger("ajaxSuccess",[s,e])}else jQuery.handleError(e,s,a)}catch(t){a="error",jQuery.handleError(e,s,a,t)}e.global&&jQuery.event.trigger("ajaxComplete",[s,e]),e.global&&! --jQuery.active&&jQuery.event.trigger("ajaxStop"),e.complete&&e.complete(s,a),jQuery(o).unbind(),setTimeout(function(){try{$(o).remove(),$(n).remove()}catch(t){jQuery.handleError(e,s,null,t)}},100),s=null}};e.timeout>0&&setTimeout(function(){r||a("timeout")},e.timeout);try{n=$("#"+o),$(n).attr("action",e.url),$(n).attr("method","POST"),$(n).attr("target",i),n.encoding?n.encoding="multipart/form-data":n.enctype="multipart/form-data",$(n).submit()}catch(t){jQuery.handleError(e,s,null,t)}return window.attachEvent?document.getElementById(i).attachEvent("onload",a):document.getElementById(i).addEventListener("load",a,!1),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;return data="xml"==type||data?r.responseXML:r.responseText,"script"==type&&jQuery.globalEval(data),"json"==type&&eval("data = "+data),"html"==type&&jQuery("<div>").html(data).evalScripts(),data}})}).call(window)},128(){(function(){!function(e){e.timeago=function(t){return t instanceof Date?i(t):i("string"==typeof t?e.timeago.parse(t):"number"==typeof t?new Date(t):e.timeago.datetime(t))};var t=e.timeago;function n(){var n=function(n){if(!(n=e(n)).data("timeago")){n.data("timeago",{datetime:t.datetime(n)});var i=e.trim(n.text());!(i.length>0)||t.isTime(n)&&n.attr("title")||n.attr("title",i)}return n.data("timeago")}(this);return isNaN(n.datetime)||e(this).text(i(n.datetime)),this}function i(e){return t.inWords(function(e){return(new Date).getTime()-e.getTime()}(e))}e.extend(e.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,strings:{formatAgo:"%s ago",formatFromNow:"%s from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},inWords:function(t){var n=this.settings.strings,i=n.formatAgo;this.settings.allowFuture&&t<0&&(i=n.formatFromNow);var o=Math.abs(t)/1e3,r=o/60,s=r/60,a=s/24,d=a/365;function l(i,o){var r=e.isFunction(i)?i(o,t):i,s=n.numbers&&n.numbers[o]||o;return r.replace(/%d/i,s)}var c=o<45&&l(n.seconds,Math.round(o))||o<90&&l(n.minute,1)||r<45&&l(n.minutes,Math.round(r))||r<90&&l(n.hour,1)||s<24&&l(n.hours,Math.round(s))||s<42&&l(n.day,1)||a<30&&l(n.days,Math.round(a))||a<45&&l(n.month,1)||a<365&&l(n.months,Math.round(a/30))||d<1.5&&l(n.year,1)||l(n.years,Math.round(d));return e.trim(i.replace(/%s/i,c))},parse:function(t){var n=e.trim(t);return n=(n=(n=(n=n.replace(/\.\d+/,"")).replace(/-/,"/").replace(/-/,"/")).replace(/T/," ").replace(/Z/," UTC")).replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(n)},datetime:function(n){var i=t.isTime(n)?e(n).attr("datetime"):e(n).attr("title");return t.parse(i)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}}),e.fn.timeago=function(){var e=this;e.each(n);var i=t.settings;return i.refreshMillis>0&&setInterval(function(){e.each(n)},i.refreshMillis),e},document.createElement("abbr"),document.createElement("time")}(jQuery)}).call(window)},186(){(function(){jQuery.timeago.settings.strings={formatAgo:gettext("%s ago"),formatFromNow:gettext("%s from now"),seconds:gettext("less than a minute"),minute:gettext("about a minute"),minutes:function(e){return ngettext("%d minute","%d minutes",e)},hour:gettext("about an hour"),hours:function(e){return ngettext("about %d hour","about %d hours",e)},day:gettext("a day"),days:function(e){return ngettext("%d day","%d days",e)},month:gettext("about a month"),months:function(e){return ngettext("%d month","%d months",e)},year:gettext("about a year"),years:function(e){return ngettext("%d year","%d years",e)},numbers:[]}}).call(window)},582(){(function(){!function(e){var t=/(\s*\S+|\s)$/;e.truncate=function(t,n){return e("<div></div>").append(t).truncate(n).html()},e.fn.truncate=function(n){e.isNumeric(n)&&(n={length:n});var i=e.extend({},e.truncate.defaults,n);return this.each(function(){var n=e(this);i.noBreaks&&n.find("br").replaceWith(" ");var o=n.text(),r=o.length-i.length;i.stripTags&&n.text(o),i.words&&r>0&&(r=o.length-o.slice(0,i.length).replace(t,"").length-1),r<0||!r&&!i.truncated||e.each(n.contents().get().reverse(),function(t,n){var o=e(n),s=o.text().length;return s<=r?(i.truncated=!0,r-=s,void o.remove()):3===n.nodeType?(e(n.splitText(s-r-1)).replaceWith(i.ellipsis),!1):(o.truncate(e.extend(i,{length:s-r})),!1)})})},e.truncate.defaults={stripTags:!1,words:!1,noBreaks:!1,length:1/0,ellipsis:"…"}}(jQuery)}).call(window)}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{"use strict";__webpack_require__(290),__webpack_require__(786),__webpack_require__(204),__webpack_require__(237),__webpack_require__(128),__webpack_require__(186),__webpack_require__(582),__webpack_require__(398),__webpack_require__(817),__webpack_require__(588),__webpack_require__(970),__webpack_require__(376),__webpack_require__(840),__webpack_require__(514),__webpack_require__(779),__webpack_require__(189),__webpack_require__(88),__webpack_require__(760),__webpack_require__(368),__webpack_require__(156),__webpack_require__(556),__webpack_require__(669),__webpack_require__(935),__webpack_require__(411),__webpack_require__(606),__webpack_require__(197),__webpack_require__(534),__webpack_require__(61),__webpack_require__(733),__webpack_require__(907),__webpack_require__(808),__webpack_require__(410)})()})();