{% load i18n %}
<h3 class="hd hd-3 problem-header"
    id="{{ short_id }}-problem-title"
    aria-describedby="{{ id }}-problem-progress"
    tabindex="-1">{{ problem.name }}</h3>
<div class="problem-progress" id="{{ id }}-problem-progress"></div>
<div class="problem">
    {{ problem.html|safe }}
    <div class="action">
        <input type="hidden" name="problem_id" value="{{ problem.name }}" />
        {% if demand_hint_possible %}
            <div class="problem-hint">
                {# Inlined hint notification #}
                <div class="notification problem-hint notification-hint is-hidden"
                     tabindex="-1">
                    <span class="icon fa fa-question" aria-hidden="true"></span>
                    <span class="notification-message"
                          aria-describedby="{{ short_id }}-problem-title"></span>
                    <div class="notification-btn-wrapper">
                        <button type="button"
                                class="btn btn-default btn-small notification-btn hint-button">
                            {% trans 'Next Hint' %}
                        </button>
                        <button type="button"
                                class="btn btn-default btn-small notification-btn review-btn sr">
                            {% trans 'Review' %}
                        </button>
                    </div>
                </div>
            </div>
        {% endif %}
        <div class="problem-action-buttons-wrapper">
            {% if demand_hint_possible %}
                <span class="problem-action-button-wrapper">
                    <button type="button"
                            class="hint-button problem-action-btn btn-link btn-small"
                            data-value="{% trans 'Hint' %}"
                            {% if not should_enable_next_hint %}disabled{% endif %}>{% trans 'Hint' %}</button>
                </span>
            {% endif %}
            {% if save_button %}
                <span class="problem-action-button-wrapper">
                    <button type="button"
                            class="save problem-action-btn btn-link btn-small"
                            data-value="{% trans 'Save' %}">
                        <span aria-hidden="true">{% trans 'Save' %}</span>
                        <span class="sr">{% trans "Save your answer" %}</span>
                    </button>
                </span>
            {% endif %}
            {% if attempts_used and reset_button %}
                <span class="problem-action-button-wrapper">
                    <button type="button"
                            class="reset problem-action-btn btn-link btn-small"
                            data-value="{% trans 'Reset' %}">
                        <span aria-hidden="true">{% trans 'Reset' %}</span><span class="sr">{% trans "Reset your answer" %}</span>
                    </button>
                </span>
            {% endif %}
            {% if answer_available %}
                <span class="problem-action-button-wrapper">
                    <button type="button"
                            class="show problem-action-btn btn-link btn-small"
                            aria-describedby="{{ short_id }}-problem-title">
                        <span class="show-label">{% trans 'Show answer' %}</span>
                    </button>
                </span>
            {% endif %}
        </div>
        <div class="submit-attempt-container">
            <button type="button"
                    class="submit btn-brand"
                    data-submitting="{{ submit_button_submitting }}"
                    data-value="{{ submit_button }}"
                    data-should-enable-submit-button="{{ should_enable_submit_button }}"
                    aria-describedby="submission_feedback_{{ short_id }}"
                    {% if not should_enable_submit_button %}disabled{% endif %}>
                <span class="submit-label">{{ submit_button }}</span>
            </button>
            {% if submit_disabled_cta %}
                {% if submit_disabled_cta.event_data %}
                    <button class="submit-cta-link-button btn-link btn-small"
                            onclick="emit_event({{ submit_disabled_cta.event_data }})">
                        {{ submit_disabled_cta.link_name }}
                    </button>
                    <span class="submit-cta-description"
                          tabindex="0"
                          role="note"
                          aria-label="description">
                        <span data-tooltip="{{ submit_disabled_cta.description }}"
                              data-tooltip-show-on-click="true"
                              class="fa fa-info-circle fa-lg"
                              aria-hidden="true"></span>
                    </span>
                    <span class="sr">({{ submit_disabled_cta.description }})</span>
                {% else %}
                    <form class="submit-cta"
                          method="post"
                          action="{{ submit_disabled_cta.link }}">
                        {% if submit_disabled_cta.link %}
                            <input type="hidden"
                                   id="csrf_token"
                                   name="csrfmiddlewaretoken"
                                   value="{{ csrf_token }}">
                            {% for form_name, form_value in submit_disabled_cta.form_values.items %}
                                <input type="hidden" name="{{ form_name }}" value="{{ form_value }}">
                            {% endfor %}
                            <button class="submit-cta-link-button btn-link btn-small">{{ submit_disabled_cta.link_name }}</button>
                        {% endif %}
                        <span class="submit-cta-description"
                              tabindex="0"
                              role="note"
                              aria-label="description">
                            <span data-tooltip="{{ submit_disabled_cta.description }}"
                                  data-tooltip-show-on-click="true"
                                  class="fa fa-info-circle fa-lg"
                                  aria-hidden="true"></span>
                        </span>
                        <span class="sr">({{ submit_disabled_cta.description }})</span>
                    </form>
                {% endif %}
            {% endif %}
            <div class="submission-feedback {% if submit_disabled_cta %}cta-enabled{% endif %}"
                 id="submission_feedback_{{ short_id }}">
                {# When attempts are not 0, the CTA above will contain a message about the number of used attempts #}
                {% if attempts_allowed %}
                    {% if attempts_allowed|stringformat:"d" %}
                        {% if not submit_disabled_cta or attempts_used == 0 %}
                            {% blocktrans with num_used=attempts_used num_total=attempts_allowed count counter=attempts_allowed %}You have used {{ num_used }} of {{ num_total }} attempt{% plural %}You have used {{ num_used }} of {{ num_total }} attempts{% endblocktrans %}
                        {% endif %}
                    {% else %}
                        <p>You have used {{ attempts_used }} of {{ attempts_allowed }} attempts</p>
                    {% endif %}
                {% endif %}
                {% if grading_method %}
                    <div>{% blocktrans with grading_method=grading_method %}Grading method: {{ grading_method }}{% endblocktrans %}</div>
                {% endif %}
                <span class="sr">{% trans "Some problems have options such as save, reset, hints, or show answer. These options follow the Submit button." %}</span>
            </div>
        </div>
    </div>
    {# Inlined gentle-alert notification #}
    <div class="notification warning notification-gentle-alert is-hidden"
         tabindex="-1">
        <span class="icon fa fa-exclamation-circle" aria-hidden="true"></span>
        <span class="notification-message"
              aria-describedby="{{ short_id }}-problem-title"></span>
        <div class="notification-btn-wrapper">
            <button type="button"
                    class="btn btn-default btn-small notification-btn review-btn sr">{% trans 'Review' %}</button>
        </div>
    </div>
    {% if answer_notification_type %}
        {% if 'correct' == answer_notification_type %}
            {# Inlined correct answer notification #}
            <div class="notification success notification-submit" tabindex="-1">
                <span class="icon fa fa-check" aria-hidden="true"></span>
                <span class="notification-message"
                      aria-describedby="{{ short_id }}-problem-title">{{ answer_notification_message }}</span>
                <div class="notification-btn-wrapper">
                    <button type="button"
                            class="btn btn-default btn-small notification-btn review-btn sr">
                        {% trans 'Review' %}
                    </button>
                </div>
            </div>
        {% endif %}
        {% if 'incorrect' == answer_notification_type %}
            {# Inlined incorrect answer notification #}
            <div class="notification error notification-submit" tabindex="-1">
                <span class="icon fa fa-close" aria-hidden="true"></span>
                <span class="notification-message"
                      aria-describedby="{{ short_id }}-problem-title">{{ answer_notification_message }}</span>
                <div class="notification-btn-wrapper">
                    <button type="button"
                            class="btn btn-default btn-small notification-btn review-btn sr">
                        {% trans 'Review' %}
                    </button>
                </div>
            </div>
        {% endif %}
        {% if 'partially-correct' == answer_notification_type %}
            {# Inlined partially-correct answer notification #}
            <div class="notification success notification-submit" tabindex="-1">
                <span class="icon fa fa-asterisk" aria-hidden="true"></span>
                <span class="notification-message"
                      aria-describedby="{{ short_id }}-problem-title">{{ answer_notification_message }}</span>
                <div class="notification-btn-wrapper">
                    <button type="button"
                            class="btn btn-default btn-small notification-btn review-btn sr">
                        {% trans 'Review' %}
                    </button>
                </div>
            </div>
        {% endif %}
        {% if 'submitted' == answer_notification_type %}
            {# Inlined submitted answer notification #}
            <div class="notification general notification-submit" tabindex="-1">
                <span class="icon fa fa-info-circle" aria-hidden="true"></span>
                <span class="notification-message"
                      aria-describedby="{{ short_id }}-problem-title">{{ answer_notification_message }}</span>
                <div class="notification-btn-wrapper">
                    <button type="button"
                            class="btn btn-default btn-small notification-btn review-btn sr">
                        {% trans 'Review' %}
                    </button>
                </div>
            </div>
        {% endif %}
    {% endif %}
    {# Inlined save notification with conditional visibility #}
    <div class="notification warning notification-save {% if not has_saved_answers %}is-hidden{% endif %}"
         tabindex="-1">
        <span class="icon fa fa-save" aria-hidden="true"></span>
        <span class="notification-message"
              aria-describedby="{{ short_id }}-problem-title">{{ save_message }}</span>
        <div class="notification-btn-wrapper">
            <button type="button"
                    class="btn btn-default btn-small notification-btn review-btn sr">{% trans 'Review' %}</button>
        </div>
    </div>
    {# Inlined show-answer notification #}
    {% trans "Answers are displayed within the problem" as notification_message %}
    <div class="notification general notification-show-answer is-hidden"
         tabindex="-1">
        <span class="icon fa fa-info-circle" aria-hidden="true"></span>
        <span class="notification-message"
              aria-describedby="{{ short_id }}-problem-title">{{ notification_message }}</span>
        <div class="notification-btn-wrapper">
            <button type="button"
                    class="btn btn-default btn-small notification-btn review-btn sr">{% trans 'Review' %}</button>
        </div>
    </div>
</div>
<script>
    function emit_event(message) {
        parent.postMessage(message, '*');
    }
</script>
